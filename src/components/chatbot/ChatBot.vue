<template>
  <div class="chatbot-container" ref="containerRef" :style="containerStyle" :class="{ dragging: isDragging }">
    <button
      class="chat-toggle"
      @click="onToggleClick"
      @touchstart="onTouchStart"
      @touchmove.prevent="onTouchMove"
      @touchend="onTouchEnd"
      :class="{ blurred: isOpen }"
    >
      <img src="@/assets/chatbot_images/chatbot_cat.png" alt="ì±—ë´‡ ë²„íŠ¼" />
    </button>
    <transition name="chat-fade">
      <div class="chat-window" v-if="isOpen">
        <div class="chat-header">
          <span class="chat-title" @click="toggleChat"> ë§ì¶”ë¨¸ë‹ˆ ì±—ë´‡ </span>
          <div class="chat-actions">
            <button class="chat-btn" @click="clearMessages" title="ëŒ€í™” ì´ˆê¸°í™”">
              ëŒ€í™” ì§€ìš°ê¸°
            </button>
            <button class="chat-btn" @click="toggleChat" title="ë‹«ê¸°">âœ–</button>
          </div>
        </div>

        <div class="chat-body" ref="chatBody">
          <div
            v-for="(msg, index) in messages"
            :key="index"
            :class="['message-wrapper', msg.role]"
          >
            <img
              v-if="msg.role === 'bot'"
              class="avatar"
              src="@/assets/chatbot_images/chatbot_cat.png"
              alt="ì±—ë´‡ í”„ë¡œí•„"
            />
            <div v-if="msg.role === 'loading'" class="spinner"></div>
            <div
              v-else
              v-html="formattedContent(msg.content)"
              class="message"
              :class="msg.role"
            ></div>
          </div>

          <!-- ë¹ ë¥¸ ë²„íŠ¼ -->
          <div class="quick-buttons">
            <transition-group name="fade-up" tag="div">
              <button
                v-for="(btn, i) in visibleButtons"
                :key="btn"
                class="quick-btn"
                :class="submenuMap[btn] ? 'main-menu' : 'sub-menu'"
                @click="handleQuickButtonClick(i)"
              >
                {{ btn }}
              </button>
            </transition-group>
          </div>
          <!-- quick-buttons ë°”ë¡œ ì•„ë˜ ìª½ì— ì¶”ê°€ -->
          <div class="cta-buttons" v-if="ctas.length">
            <button
              v-for="(c, i) in ctas"
              :key="i"
              class="cta-button"
              @click="goRoute(c.route)"
            >
              {{ c.label }}
            </button>
          </div>
        </div>

        <div class="chat-input">
          <input
            v-model="input"
            @keyup.enter="sendMessage"
            placeholder="ê¶ê¸ˆí•œ ë‚´ìš©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”."
          />
          <button @click="sendMessage">
            <img src="@/assets/chatbot_images/send-button.png" alt="ì „ì†¡" />
          </button>
        </div>
      </div>
    </transition>
  </div>
</template>
<script setup>
import { ref, nextTick, onMounted, onBeforeUnmount, computed } from 'vue';
import { useRouter } from 'vue-router';
import axios from 'axios';

const router = useRouter();
// ìƒíƒœ ì„¹ì…˜
const selectedCardType = ref(null); // 'ì‹ ìš©ì¹´ë“œ' | 'ì²´í¬ì¹´ë“œ' | null
// ì¹´ë“œ íƒ€ì… ì„ íƒ ì˜µì…˜
const CARD_TYPE_OPTIONS = ['ì‹ ìš©ì¹´ë“œ', 'ì²´í¬ì¹´ë“œ'];
/* ========== ìƒíƒœ ========== */
const chatBody = ref(null);
const isOpen = ref(false);
const input = ref('');
const showGreeting = ref(false);
const submenuIntro = ref('');
const visibleButtons = ref([]);
const messages = ref([]);
const isLoading = ref(false);
const currentParentMenu = ref(null);
// ìƒíƒœ ì„¹ì…˜ì— ì¶”ê°€
const isMenuTransitioning = ref(false); // ì¤‘ë³µ í´ë¦­ ë°©ì§€
const lastExplainedTerm = ref(null); // ìµœê·¼ ì„¤ëª…í•œ ìš©ì–´ ì €ì¥

/* ========== ëª¨ë°”ì¼ ë“œë˜ê·¸ ìœ„ì¹˜ ì„¤ì • (â‰¤480pxì—ì„œë§Œ) ========== */
const containerRef = ref(null);
const isDragging = ref(false);
const isLongPress = ref(false);
const suppressNextToggle = ref(false);
const longPressTimer = ref(null);
const startTouch = ref({ x: 0, y: 0 });
const startRect = ref({ left: 0, top: 0 });
const customPos = ref({ left: null, top: null }); // px ë‹¨ìœ„
const hasCustomPos = ref(false);
const isMobile = ref(false);

const containerStyle = computed(() => {
  // ë°ìŠ¤í¬í†±/íƒœë¸”ë¦¿ ë˜ëŠ” ì»¤ìŠ¤í…€ ìœ„ì¹˜ê°€ ì—†ìœ¼ë©´ ê¸°ì¡´ ìŠ¤íƒ€ì¼ ìœ ì§€ (ë¹ˆ ê°ì²´ ë°˜í™˜)
  if (!isMobile.value || !hasCustomPos.value || customPos.value.left === null) return {};
  // ëª¨ë°”ì¼ì—ì„œë§Œ left/top ì§€ì •í•˜ì—¬ ê³ ì •
  return {
    position: 'fixed',
    left: customPos.value.left + 'px',
    top: customPos.value.top + 'px',
    right: 'auto',
    bottom: 'auto',
  };
});

const getBtnSize = () => {
  // ëª¨ë°”ì¼ ì‚¬ì´ì¦ˆì—ì„œì˜ í† ê¸€ í¬ê¸°ì™€ ì—¬ë°±ì„ ê°ì•ˆí•´ ì‹¤ì œ ë²„íŠ¼ í¬ê¸° ì‚°ì •
  const btnEl = containerRef.value?.querySelector('.chat-toggle');
  const rect = btnEl?.getBoundingClientRect?.();
  return rect ? { w: rect.width, h: rect.height } : { w: 56, h: 56 };
};

const clamp = (val, min, max) => Math.min(Math.max(val, min), max);

const onTouchStart = (e) => {
  if (!isMobile.value) return;
  const t = e.touches[0];
  startTouch.value = { x: t.clientX, y: t.clientY };
  const rect = containerRef.value?.getBoundingClientRect?.();
  if (rect) startRect.value = { left: rect.left, top: rect.top };
  isLongPress.value = false;
  isDragging.value = false;
  if (longPressTimer.value) clearTimeout(longPressTimer.value);
  // 250ms ê¸¸ê²Œ ëˆ„ë¥´ë©´ ë“œë˜ê·¸ ì‹œì‘
  longPressTimer.value = setTimeout(() => {
    isLongPress.value = true;
    isDragging.value = true;
    suppressNextToggle.value = true; // ë“œë˜ê·¸ ë’¤ í´ë¦­ í† ê¸€ ë°©ì§€
  }, 250);
};

const onTouchMove = (e) => {
  if (!isMobile.value) return;
  if (!isLongPress.value || !isDragging.value) return;
  const t = e.touches[0];
  const dx = t.clientX - startTouch.value.x;
  const dy = t.clientY - startTouch.value.y;
  const btn = getBtnSize();
  const maxLeft = window.innerWidth - btn.w - 8; // ê°€ì¥ìë¦¬ 8px ì—¬ë°±
  const maxTop = window.innerHeight - btn.h - 8;
  const newLeft = clamp(startRect.value.left + dx, 8, maxLeft);
  const newTop = clamp(startRect.value.top + dy, 8, maxTop);
  customPos.value = { left: newLeft, top: newTop };
  hasCustomPos.value = true;
};

const onTouchEnd = () => {
  if (!isMobile.value) return;
  if (longPressTimer.value) {
    clearTimeout(longPressTimer.value);
    longPressTimer.value = null;
  }
  if (isDragging.value) {
    // ì €ì¥ (ì„¸ì…˜ ìœ ì§€)
    try {
      localStorage.setItem('chatbot_pos_v1', JSON.stringify(customPos.value));
    } catch (_) {}
  }
  // ë“œë˜ê·¸ ì¢…ë£Œ í›„ ì‚´ì§ ë”œë ˆì´ ë’¤ í´ë¦­ í—ˆìš©
  setTimeout(() => {
    suppressNextToggle.value = false;
  }, 150);
  isDragging.value = false;
  isLongPress.value = false;
};

const onToggleClick = (e) => {
  if (suppressNextToggle.value) return; // ë“œë˜ê·¸ ì§í›„ í´ë¦­ ì°¨ë‹¨
  toggleChat();
};

onMounted(() => {
  const updateMobile = () => (isMobile.value = window.innerWidth <= 480);
  updateMobile();
  window.addEventListener('resize', updateMobile);
  try {
    const saved = localStorage.getItem('chatbot_pos_v1');
    if (saved) {
      const parsed = JSON.parse(saved);
      if (
        typeof parsed?.left === 'number' &&
        typeof parsed?.top === 'number'
      ) {
        customPos.value = parsed;
        hasCustomPos.value = true;
      }
    }
  } catch (_) {}
});

onBeforeUnmount(() => {
  if (longPressTimer.value) clearTimeout(longPressTimer.value);
});

/* CTA ë²„íŠ¼ (ë§í’ì„  ë°–) */
const ctas = ref([]); // [{ label, route }]
const goRoute = async (route) => {
  // ì±—ë´‡ ë‹«ìœ¼ë©´ì„œ ì™„ì „ ì´ˆê¸°í™”
  isOpen.value = false;
  clearButtonTimers();
  ctas.value = [];
  messages.value = [];
  visibleButtons.value = [];
  currentParentMenu.value = null;
  await router.push(route);
};

// ìš©ì–´ ê¸°ë³¸ ì„¤ëª… + í›„ì† ë²„íŠ¼ ë…¸ì¶œ
const explainTerm = async (term) => {
  lastExplainedTerm.value = term;
  await sendBotMessage(`<strong>${term}</strong>ì— ëŒ€í•´ ì‰½ê²Œ ì„¤ëª…í•´ë“œë¦´ê²Œìš”!`);
  const answer = await fetchDefinitionFromGPT(term);
  await sendBotMessage(answer);

  // í›„ì† ì§ˆë¬¸ + ë²„íŠ¼(ê³„ì† ë°˜ë³µ ê°€ëŠ¥)
  await sendBotMessage(
    'í˜¹ì‹œ ì´í•´ê°€ ëœ ë˜ì…¨ë‚˜ìš”? ì›í•˜ì‹œë©´ ë” ì‰½ê²Œ ë‹¤ì‹œ ì„¤ëª…í•´ë“œë¦´ê²Œìš”.'
  );
  scheduleButtons(['ë” ì‰½ê²Œ ì„¤ëª…í•´ì¤˜', 'ê´œì°®ì•„ìš”'], {
    clear: true,
    base: 600,
    step: 160,
  });
};

// ë” ì‰¬ìš´ ì„¤ëª… + í›„ì† ë²„íŠ¼ ì¬ë…¸ì¶œ(ë¬´í•œ ë£¨í”„)
const explainTermSimpler = async () => {
  const term = lastExplainedTerm.value;
  if (!term) return;

  await sendBotMessage('ì¢‹ì•„ìš”. ë” ì‰¬ìš´ ë¹„ìœ ë¡œ ë‹¤ì‹œ ì„¤ëª…í• ê²Œìš”.');
  const simpler = await fetchSimplerDefinitionFromGPT(term);
  await sendBotMessage(simpler);

  await sendBotMessage('ì¡°ê¸ˆ ë” ë‚«ë‚˜ìš”? í•„ìš”í•˜ë©´ í•œ ë²ˆ ë” ì‰½ê²Œ í’€ì–´ë“œë¦´ê²Œìš”.');
  scheduleButtons(['ë” ì‰½ê²Œ ì„¤ëª…í•´ì¤˜', 'ê´œì°®ì•„ìš”'], {
    clear: true,
    base: 600,
    step: 160,
  });
};

// 1) ì¦‰ì‹œ ì¶œë ¥ìš© í—¬í¼
const showBotMessageImmediate = (content) => {
  messages.value.push({ role: 'bot', content });
  scrollToBottom();
};

/* ì†ë„/íƒ€ì´ë¨¸ */
const TYPING_DELAY_MS = 35; // ë¹ ë¥´ê²Œ
const buttonTimers = ref([]);
const clearButtonTimers = () => {
  buttonTimers.value.forEach((id) => clearTimeout(id));
  buttonTimers.value = [];
};
// â¬‡ï¸ ë²„íŠ¼ë“¤ì„ ìˆœì°¨(ìŠ¤íƒœê±°)ë¡œ ë³´ì—¬ì£¼ëŠ” ê³µí†µ í•¨ìˆ˜
const scheduleButtons = (
  items,
  { clear = true, base = 800, step = 220 } = {}
) => {
  if (clear) visibleButtons.value = [];
  items.forEach((item, i) => {
    const id = setTimeout(() => {
      visibleButtons.value.push(item);
    }, base + i * step);
    buttonTimers.value.push(id);
  });
};

// <script setup> ìƒë‹¨ í•¨ìˆ˜ë“¤ ìˆëŠ” ê³³ì— ì¶”ê°€
const clearMessages = async () => {
  // í•„ìš”í•˜ë©´ confirm ì¶”ê°€
  // if (!confirm('ëŒ€í™”ë¥¼ ëª¨ë‘ ì§€ìš¸ê¹Œìš”?')) return;

  clearButtonTimers();
  ctas.value = [];
  visibleButtons.value = [];
  currentParentMenu.value = null;
  messages.value = [];

  // ì²˜ìŒ ìƒíƒœë¡œ ì¸ì‚¬ + ìƒìœ„ ë²„íŠ¼ ë…¸ì¶œ
  showBotMessageImmediate(
    `ì•ˆë…•í•˜ì„¸ìš”. <strong>ë§ì¶”ë¨¸ë‹ˆ ì±—ë´‡</strong>ì…ë‹ˆë‹¤! ë¬´ì—‡ì„ ë„ì™€ë“œë¦´ê¹Œìš”?`
  );
  scheduleButtons(allButtons, { clear: true, base: 800, step: 220 });
  scrollToBottom();
};

/* ========== ë°ì´í„° ========== */
const systemPrompt =
  'chatgpt.chatbot-prompt=ë„ˆëŠ” ê¸ˆìœµ ì „ë¬¸ê°€ì•¼. ì‚¬ìš©ìê°€ ê¸ˆìœµ ê´€ë ¨ ì§ˆë¬¸(ì˜ˆ: ê¸ˆìœµ ìš©ì–´, ì˜ˆÂ·ì ê¸ˆ, ëŒ€ì¶œ, ì‹ ìš©, ì¬í…Œí¬, ê¸ˆìœµ ì •ì±…, ê¸ˆë¦¬ ë“±)ì„ í•˜ë©´ ì´ˆë³´ìë„ ì´í•´í•  ìˆ˜ ìˆë„ë¡ ì¹œì ˆí•˜ê³  ì •í™•í•˜ê²Œ, ê°„ê²°í•˜ê³  ì§§ê²Œ ì„¤ëª…í•´. ê¸ˆìœµê³¼ ë¬´ê´€í•œ ì§ˆë¬¸(ì˜ˆ: ì—°ì˜ˆ, ê²Œì„, ì—°ì• , ì—­ì‚¬, ë‚ ì”¨, ì¡ë‹´, ê¸°ìˆ , ì² í•™ ë“±)ì´ ë“¤ì–´ì˜¤ë©´ "ì£„ì†¡í•©ë‹ˆë‹¤. ì´ ì±—ë´‡ì€ ê¸ˆìœµ ê´€ë ¨ ì§ˆë¬¸ì—ë§Œ ë‹µë³€í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤."ë¼ê³ ë§Œ ì‘ë‹µí•´. ì ˆëŒ€ë¡œ ë‹¤ë¥¸ ì£¼ì œì— ëŒ€í•´ ì¶”ì¸¡í•˜ê±°ë‚˜ ë‹µí•˜ì§€ ë§ˆ. ë‹µë³€ì€ ë°˜ë“œì‹œ ë‹¤ìŒ í˜•ì‹ì„ ë”°ë¼ì•¼ í•´: 1. ë²ˆí˜¸ë‚˜ ê¸€ë¨¸ë¦¬(-) ê¸°í˜¸ë¡œ êµ¬ì¡°í™” 2. ì¤‘ìš”í•œ í‚¤ì›Œë“œëŠ” **êµµê²Œ** 3. ê¸ˆìœµ ìš©ì–´ëŠ” ì²˜ìŒ ë“±ì¥ ì‹œ ê´„í˜¸ë¡œ ì„¤ëª… 4. ë³µì¡í•œ ê°œë…ì€ ì‰¬ìš´ ì˜ˆì‹œë‚˜ ë¹„ìœ ë¡œ 5. ì–´ë ¤ìš´ ì „ë¬¸ ìš©ì–´ëŠ” í”¼í•˜ê±°ë‚˜ ì‰½ê²Œ í’€ì–´ ì“¸ ê²ƒ 6. ê¸ˆìœµ ì™¸ ì§ˆë¬¸ì€ ìœ„ ë¬¸ì¥ìœ¼ë¡œë§Œ ì‘ë‹µí•  ê²ƒ.';

const allButtons = [
  'ì„œë¹„ìŠ¤ ì´ìš©ë°©ë²•',
  'ê¸ˆìœµ ìš©ì–´ ë¬¼ì–´ë³´ê¸°',
  'í˜ë¥´ì†Œë‚˜ ìœ í˜• ì„¤ëª…',
  'ì¹´ë“œ ì¶”ì²œë°›ê¸°',
  'ì˜ˆê¸ˆ ì¶”ì²œë°›ê¸°',
  'ì ê¸ˆ ì¶”ì²œë°›ê¸°',
];

const submenuMap = {
  'ì„œë¹„ìŠ¤ ì´ìš©ë°©ë²•': [
    'í˜ë¥´ì†Œë‚˜ ê¸°ë°˜ ì¶”ì²œ',
    'ë§ˆì´ë°ì´í„° ê¸°ë°˜ ì¶”ì²œ',
    'ìƒí’ˆ ë¹„êµ ê¸°ëŠ¥',
    'ê¸ˆìœµ í€´ì¦ˆ',
    'ê¸ˆìœµ êµìœ¡ ê²Œì‹œíŒ',
  ],
  'ê¸ˆìœµ ìš©ì–´ ë¬¼ì–´ë³´ê¸°': [
    'ê¸ˆë¦¬',
    'ì›ë¦¬ê¸ˆ',
    'ë§Œê¸°',
    'ì ë¦½ì‹',
    'ê±°ì¹˜ì‹',
    'ë³µë¦¬',
    'ë‹¨ë¦¬',
    'ì‹ ìš©ë“±ê¸‰',
    'ìƒí™˜',
    'ì—°ì²´',
    'ìˆ˜ìˆ˜ë£Œ',
    'ì¤‘ë„ìƒí™˜',
    'ì˜ˆê¸ˆìë³´í˜¸',
  ],
  'í˜ë¥´ì†Œë‚˜ ìœ í˜• ì„¤ëª…': [
    'ğŸ¢ ê±°ë¶ì´ ìœ í˜•',
    'ğŸ¿ï¸ ë‹¤ëŒì¥ ìœ í˜•',
    'ğŸœ ê°œë¯¸ ìœ í˜•',
    'ğŸ¦‰ ë¶€ì—‰ì´ ìœ í˜•',
    'ğŸ° í† ë¼ ìœ í˜•',
    'ğŸ± ê³ ì–‘ì´ ìœ í˜•',
    'ğŸ¯ í˜¸ë‘ì´ ìœ í˜•',
    'ğŸ§ í­ê·„ ìœ í˜•',
  ],
  'ì¹´ë“œ ì¶”ì²œë°›ê¸°': [
    'ì¹´í˜',
    'ìŒì‹ì ',
    'êµí†µ',
    'ì‡¼í•‘',
    'ì˜¨ë¼ì¸êµ¬ë§¤',
    'í¸ì˜ì ',
    'ì˜í™”',
    'ì£¼ìœ ',
    'í•´ì™¸ê²°ì œ',
    'í†µì‹ ë¹„',
    'ê³µê³¼ê¸ˆ',
  ],
  'ì˜ˆê¸ˆ ì¶”ì²œë°›ê¸°': [
    'ë‹¨ê¸° ì—¬ìœ ìê¸ˆ',
    'ê²°í˜¼ìê¸ˆ(ì˜ˆê¸ˆ)',
    'ë…¸í›„ìê¸ˆ',
    'ìƒì—¬ê¸ˆ êµ´ë¦¬ê¸°',
    'ì•ˆì „í•œ ëª©ëˆê´€ë¦¬',
  ],
  'ì ê¸ˆ ì¶”ì²œë°›ê¸°': [
    'ì—¬í–‰ìê¸ˆ',
    'ìì·¨ë¹„ìš©',
    'ë¹„ìƒê¸ˆ',
    'ê²°í˜¼ìê¸ˆ(ì ê¸ˆ)',
    'ì‹ í˜¼ì§‘ ìê¸ˆ',
  ],
};

const serviceLinks = {
  'í˜ë¥´ì†Œë‚˜ ê¸°ë°˜ ì¶”ì²œ': '/persona/start',
  'ë§ˆì´ë°ì´í„° ê¸°ë°˜ ì¶”ì²œ': '/mydata/cards',
  'ìƒí’ˆ ë¹„êµ ê¸°ëŠ¥': '/compare',
  'ê¸ˆìœµ í€´ì¦ˆ': '/quiz',
  'ê¸ˆìœµ êµìœ¡ ê²Œì‹œíŒ': '/education/video',
};

const quickButtonPrompts = {
  'ì„œë¹„ìŠ¤ ì´ìš©ë°©ë²•':
    'ì´ í”Œë«í¼ì€ ì‚¬ìš©ìì˜ ê¸ˆìœµ ìƒí™œì„ ë•ê¸° ìœ„í•´ ë‹¤ì–‘í•œ ê¸°ëŠ¥ì„ ì œê³µí•©ë‹ˆë‹¤. ì•„ë˜ëŠ” ì£¼ìš” ì„œë¹„ìŠ¤ì…ë‹ˆë‹¤. ê¶ê¸ˆí•œ í•­ëª©ì„ ì„ íƒí•´ì£¼ì„¸ìš”:\n\n- í˜ë¥´ì†Œë‚˜ ê¸°ë°˜ ì¶”ì²œ\n- ë§ˆì´ë°ì´í„° ê¸°ë°˜ ì¶”ì²œ\n- ìƒí’ˆ ë¹„êµ ê¸°ëŠ¥\n- ê¸ˆìœµ í€´ì¦ˆ\n- ê¸ˆìœµ êµìœ¡ ê²Œì‹œíŒ',
  'í˜ë¥´ì†Œë‚˜ ê¸°ë°˜ ì¶”ì²œ':
    'í˜ë¥´ì†Œë‚˜ ê¸°ë°˜ ì¶”ì²œ:\nì‚¬ìš©ìì˜ ê¸ˆìœµ ì„±í–¥ì„ ë¶„ì„í•˜ì—¬ 8ê°€ì§€ ë™ë¬¼ ìœ í˜• ì¤‘ í•˜ë‚˜ë¡œ ë¶„ë¥˜í•˜ê³ , ì´ì— ë§ëŠ” ì˜ˆê¸ˆ/ì ê¸ˆ/ì¹´ë“œ ìƒí’ˆì„ ì¶”ì²œí•´ë“œë¦½ë‹ˆë‹¤. í˜ë¥´ì†Œë‚˜ëŠ” ì†Œë¹„ ì„±í–¥, ìì‚° ëª©í‘œ ë“±ì„ ê¸°ë°˜ìœ¼ë¡œ ì„¤ì •ë˜ë©°, ë§ˆì´í˜ì´ì§€ì—ì„œ ìˆ˜ì • ê°€ëŠ¥í•©ë‹ˆë‹¤.',
  'ë§ˆì´ë°ì´í„° ê¸°ë°˜ ì¶”ì²œ':
    'ë§ˆì´ë°ì´í„° ê¸°ë°˜ ì¶”ì²œ:\nì‚¬ìš©ìì˜ ì†Œë¹„ ë‚´ì—­, ì ê¸ˆÂ·ì˜ˆê¸ˆ ì´ë ¥ ë“±ì„ ë¶„ì„í•˜ì—¬ ê°œì¸í™”ëœ ê¸ˆìœµìƒí’ˆì„ ì¶”ì²œí•©ë‹ˆë‹¤. ì—°ë™ëœ ë‚´ì—­ì„ ê¸°ë°˜ìœ¼ë¡œ ìë™ ë¶„ì„ë˜ë©°, ë‚˜ì˜ ì‹¤ì œ ì†Œë¹„ì— ë§ëŠ” ì¶”ì²œì„ ë°›ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.',
  'ìƒí’ˆ ë¹„êµ ê¸°ëŠ¥':
    'ìƒí’ˆ ë¹„êµ ê¸°ëŠ¥:\nì¹´ë“œ, ì˜ˆê¸ˆ, ì ê¸ˆ ë“± ê´€ì‹¬ ìˆëŠ” ìƒí’ˆì„ ìµœëŒ€ 3ê°œê¹Œì§€ ì„ íƒí•´ ì£¼ìš” ì¡°ê±´(ê¸ˆë¦¬, ìˆ˜ìˆ˜ë£Œ, ì‹¤ì  ë“±)ì„ í•œëˆˆì— ë¹„êµí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. í•„í„°ë§ê³¼ ì •ë ¬ ê¸°ëŠ¥ë„ í•¨ê»˜ ì œê³µë©ë‹ˆë‹¤.',
  'ê¸ˆìœµ í€´ì¦ˆ':
    'ê¸ˆìœµ í€´ì¦ˆ:\nO/X ë° ê°ê´€ì‹ ë¬¸ì œë¥¼ í†µí•´ ê¸ˆìœµ ì§€ì‹ì„ ì¬ë¯¸ìˆê²Œ í•™ìŠµí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì •ë‹µ ì‹œ í•´ì„¤ê³¼ ê²½í—˜ì¹˜ê°€ ì£¼ì–´ì§€ë©°, ë ˆë²¨ ì‹œìŠ¤í…œê³¼ ë±ƒì§€ ë³´ìƒë„ ì œê³µë©ë‹ˆë‹¤.',
  'ê¸ˆìœµ êµìœ¡ ê²Œì‹œíŒ':
    'ê¸ˆìœµ êµìœ¡ ê²Œì‹œíŒ:\nê¸ˆìœµê°ë…ì› Open APIë¥¼ í†µí•´ ì œê³µë˜ëŠ” ë‹¤ì–‘í•œ ê¸ˆìœµ êµìœ¡ ì½˜í…ì¸ ë¥¼ ì£¼ì œë³„ë¡œ í•™ìŠµí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì œëª© ê²€ìƒ‰ ë° ì¹´í…Œê³ ë¦¬ í•„í„°ë§ ê¸°ëŠ¥ë„ ì œê³µë©ë‹ˆë‹¤.',
  'ê¸ˆìœµ ìš©ì–´ ë¬¼ì–´ë³´ê¸°':
    "ë³µë¦¬, ë‹¨ë¦¬, ì—° ì´ìœ¨, ìš°ëŒ€ê¸ˆë¦¬, DSR, ì‹ ìš©ë“±ê¸‰ ë“± ì´ˆë³´ìê°€ ì–´ë ¤ì›Œí•˜ëŠ” ê¸ˆìœµ ìš©ì–´ë“¤ì„ ì¹œì ˆí•˜ê³  ì‰¬ìš´ ì˜ˆì‹œì™€ í•¨ê»˜ ì„¤ëª…í•´ì¤˜. ì˜ˆ: 'ë³µë¦¬'ëŠ” ë¬´ì—‡ì´ê³  ì–´ë–¤ ìƒí’ˆì—ì„œ ì ìš©ë˜ë©° ì™œ ì¤‘ìš”í•œê°€ìš”?",
  'í˜ë¥´ì†Œë‚˜ ìœ í˜• ì„¤ëª…':
    'ì•„ë˜ ì¤‘ ìì‹ ì˜ ì„±í–¥ì— ê°€ì¥ ê°€ê¹Œìš´ ë™ë¬¼ì„ ì„ íƒí•´ì£¼ì„¸ìš”:\n\n- ğŸ¢ ê±°ë¶ì´ ìœ í˜•\n- ğŸ¿ï¸ ë‹¤ëŒì¥ ìœ í˜•\n- ğŸœ ê°œë¯¸ ìœ í˜•\n- ğŸ¦‰ ë¶€ì—‰ì´ ìœ í˜•\n- ğŸ° í† ë¼ ìœ í˜•\n- ğŸ± ê³ ì–‘ì´ ìœ í˜•\n- ğŸ¯ í˜¸ë‘ì´ ìœ í˜•\n- ğŸ§ í­ê·„ ìœ í˜•',
  // (ë™ë¬¼ ì„¤ëª…ì€ ì•„ë˜ personaDescriptions ì‚¬ìš©)
  'ì¹´ë“œ ì¶”ì²œë°›ê¸°':
    'ì£¼ë¡œ ì–´ë–¤ ë¶„ì•¼ì— ì†Œë¹„ê°€ ë§ì€ê°€ìš”? ì•„ë˜ì—ì„œ ì„ íƒí•˜ê±°ë‚˜ ì§ì ‘ ì…ë ¥í•´ì£¼ì„¸ìš”.\n\nì˜ˆ: ì¹´í˜, ìŒì‹ì , êµí†µ, ì‡¼í•‘, ì˜¨ë¼ì¸êµ¬ë§¤, í¸ì˜ì , ì˜í™”, ì£¼ìœ , í•´ì™¸ê²°ì œ, í†µì‹ ë¹„, ê³µê³¼ê¸ˆ ë“±',
  ì¹´í˜: 'â˜• ì¹´í˜ ì†Œë¹„ê°€ ë§ìœ¼ì‹œêµ°ìš”! ì»¤í”¼ í”„ëœì°¨ì´ì¦ˆ ìœ„ì£¼ í• ì¸ ì¹´ë“œë“¤ì„ ì¶”ì²œí•´ë“œë¦´ê²Œìš”.\n- ìŠ¤íƒ€ë²…ìŠ¤, ì´ë””ì•¼ ë“± í• ì¸\n- ì›” ì‹¤ì  30ë§Œì› ì´ìƒ\n- ì—°íšŒë¹„ 1ë§Œì› ì´í•˜\n\nâ†’ [ì¶”ì²œ ì¹´ë“œ ë³´ê¸°]',
  ìŒì‹ì :
    'ğŸ½ï¸ ì™¸ì‹ì´ ì¦ìœ¼ì‹œêµ°ìš”! ì£¼ìš” ìŒì‹ì  ë¸Œëœë“œì—ì„œ í˜œíƒì´ ìˆëŠ” ì¹´ë“œ ì¶”ì²œë“œë¦½ë‹ˆë‹¤.\n\nâ†’ [ì¶”ì²œ ì¹´ë“œ ë³´ê¸°]',
  êµí†µ: 'ğŸšŒ êµí†µë¹„ ì¤‘ì‹¬ ì†Œë¹„êµ°ìš”! ëŒ€ì¤‘êµí†µ/íƒì‹œ í• ì¸ ì¹´ë“œ ì•Œë ¤ë“œë¦´ê²Œìš”.\n\nâ†’ [ì¶”ì²œ ì¹´ë“œ ë³´ê¸°]',
  ì‡¼í•‘: 'ğŸ›ï¸ ì‡¼í•‘ ì¤‘ì‹¬ ì†Œë¹„ìë¼ë©´ ì˜¨ë¼ì¸ëª° ë˜ëŠ” ë°±í™”ì  ì œíœ´ ì¹´ë“œê°€ ì í•©í•´ìš”.\n\nâ†’ [ì¶”ì²œ ì¹´ë“œ ë³´ê¸°]',
  ì˜¨ë¼ì¸êµ¬ë§¤:
    'ğŸ’» ì¿ íŒ¡, Gë§ˆì¼“ ë“± ì˜¨ë¼ì¸ ê²°ì œ í˜œíƒì´ ë§ì€ ì¹´ë“œ ì¶”ì²œë“œë¦½ë‹ˆë‹¤.\n\nâ†’ [ì¶”ì²œ ì¹´ë“œ ë³´ê¸°]',
  í¸ì˜ì :
    'ğŸª CU, GS25 ë“±ì—ì„œ í• ì¸ ê°€ëŠ¥í•œ ì¹´ë“œ ì¶”ì²œë“œë¦½ë‹ˆë‹¤.\n\nâ†’ [ì¶”ì²œ ì¹´ë“œ ë³´ê¸°]',
  ì˜í™”: 'ğŸ¬ ì˜í™”ê´€ í• ì¸ ìœ„ì£¼ ì¹´ë“œ ì¶”ì²œë“œë¦½ë‹ˆë‹¤.\n\nâ†’ [ì¶”ì²œ ì¹´ë“œ ë³´ê¸°]',
  ì£¼ìœ : 'â›½ ì£¼ìœ ì†Œ ë¦¬í„°ë‹¹ í• ì¸ ì¹´ë“œ, GSì¹¼í…ìŠ¤ ì œíœ´ ë“±ì„ í¬í•¨í•œ ì¶”ì²œì„ ë“œë¦´ê²Œìš”.\n\nâ†’ [ì¶”ì²œ ì¹´ë“œ ë³´ê¸°]',
  í•´ì™¸ê²°ì œ:
    'ğŸŒ í•´ì™¸ ì§êµ¬ë‚˜ ì—¬í–‰ ì‹œ í™˜ìœ¨ ìš°ëŒ€ì™€ ìºì‹œë°±ì´ ìˆëŠ” ì¹´ë“œ ì¶”ì²œë“œë¦½ë‹ˆë‹¤.\n\nâ†’ [ì¶”ì²œ ì¹´ë“œ ë³´ê¸°]',
  í†µì‹ ë¹„:
    'ğŸ“± í†µì‹ ìš”ê¸ˆ ìë™ì´ì²´ ì‹œ í• ì¸ë˜ëŠ” ì¹´ë“œ ì¶”ì²œë“œë¦½ë‹ˆë‹¤.\n\nâ†’ [ì¶”ì²œ ì¹´ë“œ ë³´ê¸°]',
  ê³µê³¼ê¸ˆ:
    'ğŸ’¡ ë„ì‹œê°€ìŠ¤, ì „ê¸°, ìˆ˜ë„ ìš”ê¸ˆ ìë™ì´ì²´ í• ì¸ ì¹´ë“œ ì¶”ì²œë“œë¦½ë‹ˆë‹¤.\n\nâ†’ [ì¶”ì²œ ì¹´ë“œ ë³´ê¸°]',
  'ì˜ˆì ê¸ˆ ì¶”ì²œë°›ê¸°':
    'ì˜ˆê¸ˆê³¼ ì ê¸ˆ ì¤‘ ì–´ë–¤ ìƒí’ˆì„ ì¶”ì²œë°›ê³  ì‹¶ìœ¼ì‹ ê°€ìš”?\n\n- ì˜ˆê¸ˆ ì¶”ì²œë°›ê¸°\n- ì ê¸ˆ ì¶”ì²œë°›ê¸°',
  'ì˜ˆê¸ˆ ì¶”ì²œë°›ê¸°':
    'ì˜ˆê¸ˆ ìƒí’ˆì€ ì¼ì • ê¸ˆì•¡ì„ í•œ ë²ˆì— ì˜ˆì¹˜í•˜ê³  ë§Œê¸°ê¹Œì§€ ë³´ê´€í•˜ëŠ” ìƒí’ˆì…ë‹ˆë‹¤. ì˜ˆê¸ˆ ëª©ì ì„ ì•Œë ¤ì£¼ì„¸ìš”.\n\nì˜ˆ: ë‹¨ê¸° ì—¬ìœ ìê¸ˆ, ê²°í˜¼ìê¸ˆ, ë…¸í›„ìê¸ˆ, ìƒì—¬ê¸ˆ êµ´ë¦¬ê¸°, ì•ˆì „í•œ ëª©ëˆê´€ë¦¬ ë“±',
  'ë‹¨ê¸° ì—¬ìœ ìê¸ˆ':
    'ğŸ’¸ ë‹¨ê¸° ìš´ìš© ëª©ì ì˜ ê³ ê¸ˆë¦¬ ì˜ˆê¸ˆ ìƒí’ˆì„ ì¶”ì²œí•´ë“œë¦½ë‹ˆë‹¤.\n- 3~6ê°œì›” ìƒí’ˆ\n- ì¤‘ë„í•´ì§€ ê°€ëŠ¥\n- ìš°ëŒ€ì¡°ê±´ ê°„ë‹¨\n\nâ†’ [ì¶”ì²œ ìƒí’ˆ ë³´ê¸°]',
  'ê²°í˜¼ìê¸ˆ(ì˜ˆê¸ˆ)':
    'ğŸ’ ì¥ê¸° ìê¸ˆ ë§ˆë ¨ìš© ì˜ˆê¸ˆ ì¶”ì²œë“œë¦½ë‹ˆë‹¤.\n- 12~24ê°œì›” ê³ ì •ê¸ˆë¦¬\n- ê¸‰ì—¬ì´ì²´ ìš°ëŒ€\n\nâ†’ [ì¶”ì²œ ìƒí’ˆ ë³´ê¸°]',
  ë…¸í›„ìê¸ˆ:
    'ğŸ‘µ ë…¸í›„ëŒ€ë¹„ ìì‚°ê´€ë¦¬ìš© ì˜ˆê¸ˆ ì¶”ì²œë“œë¦½ë‹ˆë‹¤.\n- ì•ˆì „ì„± ì¤‘ì‹œ\n- ê³ ë ¹ì ì „ìš© ìƒí’ˆë„ í¬í•¨\n\nâ†’ [ì¶”ì²œ ìƒí’ˆ ë³´ê¸°]',
  'ìƒì—¬ê¸ˆ êµ´ë¦¬ê¸°':
    'ğŸ’¼ ìƒì—¬ê¸ˆì´ë‚˜ ë³´ë„ˆìŠ¤ë¥¼ 3~6ê°œì›” ì•ˆì „í•˜ê²Œ êµ´ë¦´ ìˆ˜ ìˆëŠ” ìƒí’ˆì„ ì¶”ì²œí•©ë‹ˆë‹¤.\n\nâ†’ [ì¶”ì²œ ìƒí’ˆ ë³´ê¸°]',
  'ì•ˆì „í•œ ëª©ëˆê´€ë¦¬':
    'ğŸ”’ ì›ê¸ˆë³´ì¥ê³¼ ì˜ˆê¸ˆì ë³´í˜¸ ëŒ€ìƒ ê³ ê¸ˆë¦¬ ì •ê¸°ì˜ˆê¸ˆ ìœ„ì£¼ë¡œ ì¶”ì²œë“œë¦½ë‹ˆë‹¤.\n\nâ†’ [ì¶”ì²œ ìƒí’ˆ ë³´ê¸°]',
  'ì ê¸ˆ ì¶”ì²œë°›ê¸°':
    'ì ê¸ˆì€ ë§¤ë‹¬ ì¼ì • ê¸ˆì•¡ì„ ì ë¦½í•˜ë©° ëª©ëˆì„ ë§Œë“œëŠ” ìƒí’ˆì…ë‹ˆë‹¤. ì ê¸ˆ ëª©í‘œë¥¼ ì•Œë ¤ì£¼ì„¸ìš”.\n\nì˜ˆ: ì—¬í–‰ìê¸ˆ, ìì·¨ë¹„ìš©, ë¹„ìƒê¸ˆ, ê²°í˜¼ìê¸ˆ, ì‹ í˜¼ì§‘ ìê¸ˆ ë“±',
  ì—¬í–‰ìê¸ˆ:
    'âœˆï¸ ì—¬í–‰ ê²½ë¹„ ë§ˆë ¨ì„ ìœ„í•œ ì ê¸ˆ ìƒí’ˆ ì¶”ì²œë“œë¦½ë‹ˆë‹¤.\n- 6~12ê°œì›” ë‹¨ê¸° ì ë¦½ì‹\n- ìš°ëŒ€ì¡°ê±´: ì•± ë¡œê·¸ì¸, ìë™ì´ì²´\n\nâ†’ [ì¶”ì²œ ìƒí’ˆ ë³´ê¸°]',
  ìì·¨ë¹„ìš©:
    'ğŸ  ì›”ì„¸ ë° ìƒí™œë¹„ ì¤€ë¹„ìš© ì ê¸ˆ ìƒí’ˆ ì¶”ì²œë“œë¦½ë‹ˆë‹¤.\n\nâ†’ [ì¶”ì²œ ìƒí’ˆ ë³´ê¸°]',
  ë¹„ìƒê¸ˆ:
    'ğŸš¨ ê¸‰í•  ë•Œë¥¼ ëŒ€ë¹„í•œ ì§§ì€ ì ê¸ˆ ìƒí’ˆ ì¶”ì²œë“œë¦½ë‹ˆë‹¤.\n- ììœ ì ë¦½ì‹\n- ì¤‘ë„í•´ì§€ ìˆ˜ìˆ˜ë£Œ ì ìŒ\n\nâ†’ [ì¶”ì²œ ìƒí’ˆ ë³´ê¸°]',
  'ê²°í˜¼ìê¸ˆ(ì ê¸ˆ)':
    'ğŸ’ ì¥ê¸° ê³„íšìœ¼ë¡œ ê²°í˜¼ ìê¸ˆì„ ëª¨ìœ¼ëŠ” ì ê¸ˆ ì¶”ì²œë“œë¦½ë‹ˆë‹¤.\n- 24ê°œì›” ì´ìƒ ê³ ì • ê¸ˆë¦¬\n\nâ†’ [ì¶”ì²œ ìƒí’ˆ ë³´ê¸°]',
  'ì‹ í˜¼ì§‘ ìê¸ˆ':
    'ğŸ¡ ì „ì„¸ìê¸ˆ/ì²­ì•½ê³¼ ë³‘í–‰ ê°€ëŠ¥í•œ ì ê¸ˆ ìƒí’ˆì„ ì•ˆë‚´ë“œë¦½ë‹ˆë‹¤.\n\nâ†’ [ì¶”ì²œ ìƒí’ˆ ë³´ê¸°]',
};

/* í˜ë¥´ì†Œë‚˜: ë¼ë²¨ â†’ ì½”ë“œ/ì„¤ëª… */
const personaCodeMap = {
  'ğŸ¢ ê±°ë¶ì´ ìœ í˜•': 'turtle',
  'ğŸ¿ï¸ ë‹¤ëŒì¥ ìœ í˜•': 'squirrel',
  'ğŸœ ê°œë¯¸ ìœ í˜•': 'ant',
  'ğŸ¦‰ ë¶€ì—‰ì´ ìœ í˜•': 'owl',
  'ğŸ° í† ë¼ ìœ í˜•': 'rabbit',
  'ğŸ± ê³ ì–‘ì´ ìœ í˜•': 'cat',
  'ğŸ¯ í˜¸ë‘ì´ ìœ í˜•': 'tiger',
  'ğŸ§ í­ê·„ ìœ í˜•': 'penguin',
};
const personaDescriptions = {
  'ğŸ¢ ê±°ë¶ì´ ìœ í˜•':
    'â€˜ì•ˆì •ì¶”êµ¬í˜•â€™ì— í•´ë‹¹í•˜ëŠ” ê±°ë¶ì´ ìœ í˜•ì€ ì†ì‹¤ íšŒí”¼, ì•ˆì •, ë¬´ì‹¤ì , ì˜ˆê¸ˆ ì„ í˜¸ì˜ ì„±í–¥ì„ ê°€ì§€ê³  ìˆìŠµë‹ˆë‹¤. ë§¤ìš° ì¡°ì‹¬ìŠ¤ëŸ½ê³  ëŠë¦¿í•˜ì§€ë§Œ ê¾¸ì¤€í•œ ì„±ê²©ìœ¼ë¡œ, ì›ê¸ˆ ì†ì‹¤ì— ê·¹ë„ë¡œ ë¯¼ê°í•˜ì—¬ ë¦¬ìŠ¤í¬ê°€ ì—†ëŠ” ì•ˆì „í•œ ê¸ˆìœµìƒí’ˆì„ ì„ í˜¸í•©ë‹ˆë‹¤. ì˜ˆê¸ˆì ë³´í˜¸ê°€ ë˜ëŠ” ìƒí’ˆ, ê³ ì •ê¸ˆë¦¬ ì˜ˆê¸ˆ, ì‹¤ì  ì¡°ê±´ì´ ì—†ëŠ” ì¹´ë“œì— ê´€ì‹¬ì´ ë§ìœ¼ë©°, ì†í•´ë§Œ ë³´ì§€ ì•Šìœ¼ë©´ ëœë‹¤ëŠ” ì‹ ë…ì„ ê°€ì§€ê³  ìˆìŠµë‹ˆë‹¤. ì´ëŸ¬í•œ ì„±í–¥ ë•Œë¬¸ì— ì¥ê¸°ì ìœ¼ë¡œ ìˆ˜ìµë¥ ì€ ë‚®ì„ ìˆ˜ ìˆìœ¼ë‚˜, ê¾¸ì¤€íˆ ìì‚°ì„ ìŒ“ëŠ” ë°ì—ëŠ” ê°•ì ì„ ë³´ì…ë‹ˆë‹¤.',
  'ğŸ¿ï¸ ë‹¤ëŒì¥ ìœ í˜•':
    'â€˜ê³„íší˜• ì ˆì•½ê°€â€™ì¸ ë‹¤ëŒì¥ ìœ í˜•ì€ ê³„íšì  ì €ì¶•, ìë™ì´ì²´, ëª©í‘œ ì„¤ì •ì„ ì¤‘ìš”ì‹œí•˜ëŠ” ì‚¬ëŒì…ë‹ˆë‹¤. ë‹¤ëŒì¥ê°€ ê²¨ìš¸ì„ ëŒ€ë¹„í•´ ë¨¹ì´ë¥¼ í•˜ë‚˜í•˜ë‚˜ ëª¨ìœ¼ë“¯, ì´ ìœ í˜•ì€ ëšœë ·í•œ ì €ì¶• ëª©í‘œë¥¼ ê°€ì§€ê³  ìˆê³  ì´ë¥¼ ë‹¬ì„±í•˜ê¸° ìœ„í•œ ìë™ì´ì²´, ì¥ê¸° ë‚©ì… ìŠµê´€ ë“±ì„ ì˜ ì‹¤ì²œí•©ë‹ˆë‹¤. ë¬´ê³„íš ì†Œë¹„ëŠ” ë¶ˆì•ˆí•˜ê²Œ ì—¬ê¸°ë©°, ì†Œë¹„ë³´ë‹¤ëŠ” ì €ì¶• ì¤‘ì‹¬ì˜ ê¸ˆìœµ í–‰ë™ì„ ë³´ì…ë‹ˆë‹¤. ì£¼ë¡œ ìë™ì´ì²´ ìš°ëŒ€ê¸ˆë¦¬ ìƒí’ˆì´ë‚˜ ëª©í‘œ ì„¤ì •í˜• ì ê¸ˆì„ ì„ í˜¸í•©ë‹ˆë‹¤.',
  'ğŸœ ê°œë¯¸ ìœ í˜•':
    'â€˜ì¬í…Œí¬ ì‹¤ì²œê°€â€™ì¸ ê°œë¯¸ ìœ í˜•ì€ ì‹¤ì²œë ¥, ì‹¤ì  ë¦¬ì›Œë“œ, ììœ  ì ê¸ˆê³¼ ê°™ì€ í‚¤ì›Œë“œë¡œ ì„¤ëª…í•  ìˆ˜ ìˆìœ¼ë©°, ë‹¨ìˆœíˆ ì •ë³´ë¥¼ ìˆ˜ì§‘í•˜ëŠ” ë° ê·¸ì¹˜ì§€ ì•Šê³  ì‹¤ì œë¡œ ê¸ˆìœµ í˜œíƒì„ ì ê·¹ì ìœ¼ë¡œ ì±™ê¸°ëŠ” ì„±í–¥ì„ ê°€ì§‘ë‹ˆë‹¤. ì‹¤ì ì„ ì±„ì›Œ ë¦¬ì›Œë“œë¥¼ ë°›ëŠ” ì¹´ë“œ, ììœ ë¡­ê²Œ ì…ê¸ˆ ê°€ëŠ¥í•œ ì ê¸ˆ, í¬ì¸íŠ¸ ì ë¦½ì´ë‚˜ íˆ¬ìí˜• ìƒí’ˆì—ë„ ê´€ì‹¬ì´ ë§ìœ¼ë©°, ì¬í…Œí¬ ì„±ê³µê¸°ë¥¼ ìì£¼ ì°¸ê³ í•˜ê³  ì‹¤ì²œìœ¼ë¡œ ì˜®ê¹ë‹ˆë‹¤. ê¸ˆìœµ í–‰ë™ì´ ëŠ¥ë™ì ì´ê³  ì „ëµì ì¸ ê²ƒì´ íŠ¹ì§•ì…ë‹ˆë‹¤.',
  'ğŸ¦‰ ë¶€ì—‰ì´ ìœ í˜•':
    'â€˜ì •ë³´íƒìƒ‰í˜•â€™ì¸ ë¶€ì—‰ì´ëŠ” ë¶„ì„, ë¹„êµ, ë§ì¶¤í˜• í˜œíƒì„ ì¶”êµ¬í•˜ëŠ” ì„±í–¥ìœ¼ë¡œ, ê¸ˆìœµìƒí’ˆì„ ê³ ë¥¼ ë•Œ ìˆ˜ìˆ˜ë£Œ, ì¡°ê±´, í˜œíƒ ë“±ì„ ê¼¼ê¼¼íˆ ë¹„êµí•˜ê³  ë¶„ì„í•©ë‹ˆë‹¤. ì¹´ë“œì‚¬ë³„ í˜œíƒ ë¹„êµ, ì»¤ë®¤ë‹ˆí‹° í›„ê¸°, ìƒí’ˆ ìƒì„¸ ì¡°ê±´ ë“±ì„ ì² ì €í•˜ê²Œ ì‚´í”¼ë©°, ë³¸ì¸ì—ê²Œ ê°€ì¥ ìµœì ì¸ ìƒí’ˆì„ ì°¾ì•„ë‚´ëŠ” ë° ì§‘ì¤‘í•©ë‹ˆë‹¤. DIY ì¹´ë“œì²˜ëŸ¼ ë³¸ì¸ì´ í˜œíƒì„ êµ¬ì„±í•  ìˆ˜ ìˆëŠ” ìœ ì—°í•œ ìƒí’ˆì„ ì„ í˜¸í•˜ê³ , ì •ë³´ íƒìƒ‰ê³¼ ë¹„êµ ë¶„ì„ì´ ê³§ ì†Œë¹„ë¼ê³  ì—¬ê¹ë‹ˆë‹¤.',
  'ğŸ° í† ë¼ ìœ í˜•':
    'â€˜ì†Œë¹„ì¤‘ì‹¬í˜•â€™ì— í•´ë‹¹í•˜ëŠ” í† ë¼ ìœ í˜•ì€ í• ì¸, ì´ì»¤ë¨¸ìŠ¤, ì†Œë¹„ í˜œíƒì„ ê°€ì¥ ì¤‘ì‹œí•˜ëŠ” ì‚¬ëŒìœ¼ë¡œ, ì‡¼í•‘ ì‹œ í• ì¸ í­ì´ í¬ê³  ì‚¬ìš©ì´ í¸í•œ ì¹´ë“œë¥¼ ì„ í˜¸í•©ë‹ˆë‹¤. ì¿ íŒ¡, ë§ˆì¼“ì»¬ë¦¬, ë°°ë‹¬ì˜ë¯¼ì¡± ë“±ê³¼ ì—°ê³„ëœ í• ì¸ í˜œíƒ, ìºì‹œë°±, ì ë¦½í˜• ì¹´ë“œì— ë§¤ë ¥ì„ ëŠë¼ë©°, ì†Œë¹„ ìì²´ë¥¼ ì¦ê¸°ëŠ” í¸ì…ë‹ˆë‹¤. ì†Œë¹„ì—ì„œ ë§Œì¡±ê°ì„ ì–»ê³  ë‹¤ì–‘í•œ í”Œë«í¼ì„ í™œìš©í•´ ìƒí™œë¹„ë¥¼ ì ˆì•½í•˜ë ¤ëŠ” ì‹¤ìš©ì ì¸ ê²½í–¥ì„ ë³´ì…ë‹ˆë‹¤.',
  'ğŸ± ê³ ì–‘ì´ ìœ í˜•':
    'â€˜ìê¸°í‘œí˜„í˜•â€™ì¸ ê³ ì–‘ì´ëŠ” ë””ìì¸, ê°ì„±ì†Œë¹„, íŒ¬ì‹¬ì„ ì¤‘ìš”í•˜ê²Œ ì—¬ê¹ë‹ˆë‹¤. ëˆì„ ë‹¨ìˆœí•œ ê±°ë˜ ìˆ˜ë‹¨ì´ ì•„ë‹ˆë¼ ìì‹ ì˜ ì·¨í–¥ê³¼ ê°ì„±ì„ í‘œí˜„í•˜ëŠ” ìˆ˜ë‹¨ìœ¼ë¡œ ì—¬ê¸°ë©°, ì˜ˆìœ ì¹´ë“œ ë””ìì¸ì´ë‚˜ ì•„ì´ëŒ êµ¿ì¦ˆê°€ ì—°ê³„ëœ íŒ¬ì¹´ë“œ, í•œì •íŒ ìƒí’ˆ ë“± ê°ì„±ì ì´ê³  ê°œì„±ì ì¸ ìš”ì†Œì— ëŒë¦½ë‹ˆë‹¤. í˜œíƒë³´ë‹¤ë„ ë‚´ê°€ ë§Œì¡±í•˜ëŠ” ê²ƒì´ ì¤‘ìš”í•œ ê¸°ì¤€ì´ë©°, ì†Œë¹„ë¥¼ í†µí•´ ìì‹ ì˜ ì •ì²´ì„±ê³¼ ì·¨í–¥ì„ ë“œëŸ¬ë‚´ëŠ” ê²½í–¥ì´ ê°•í•©ë‹ˆë‹¤.',
  'ğŸ¯ í˜¸ë‘ì´ ìœ í˜•':
    'â€˜ì„±ì¥íˆ¬ìí˜•â€™ì¸ í˜¸ë‘ì´ ìœ í˜•ì€ ê³ ìˆ˜ìµ íˆ¬ì, ì£¼ì‹, ETF ë“± ê³ ìœ„í—˜Â·ê³ ìˆ˜ìµ ìƒí’ˆì„ ì„ í˜¸í•˜ë©°, ëˆì€ êµ´ë ¤ì•¼ ë¶ˆì–´ë‚œë‹¤ëŠ” íˆ¬ì ì² í•™ì„ ê°€ì§€ê³  ìˆìŠµë‹ˆë‹¤. ìœ„í—˜ì„ ê°ìˆ˜í•˜ë”ë¼ë„ ë” í° ìˆ˜ìµì„ ìœ„í•´ ì£¼ì‹, ETF, í¬ì¸íŠ¸ íˆ¬ì ë“±ì˜ ê¸ˆìœµìƒí’ˆì„ í™œë°œíˆ í™œìš©í•˜ë©°, ê¸ˆìœµ ë‰´ìŠ¤ì™€ íˆ¬ì ì •ë³´ë¥¼ ê¾¸ì¤€íˆ í™•ì¸í•©ë‹ˆë‹¤. íˆ¬ì ê³µë¶€ì—ë„ ì ê·¹ì ì´ë©°, ìˆ˜ìµë¥  ê·¸ë˜í”„ë‚˜ í€ë“œ ì„±ê³¼ë¥¼ ê¼¼ê¼¼íˆ ë³´ëŠ” ì„±í–¥ì´ ìˆìŠµë‹ˆë‹¤.',
  'ğŸ§ í­ê·„ ìœ í˜•':
    'â€˜ë³´ìˆ˜ì  íˆ¬ìí˜•â€™ì¸ í­ê·„ì€ ë³´í—˜, ìƒí™œë³´ì¥, ì•ˆì •ì„± ìˆëŠ” íˆ¬ìë¥¼ ì¤‘ìš”ì‹œí•˜ë©°, ìœ„í—˜ì„ ì™„ì „íˆ í”¼í•˜ì§€ëŠ” ì•Šë˜ ê°€ëŠ¥í•œ í•œ ë°©ì–´ì ì¸ íƒœë„ë¥¼ ìœ ì§€í•©ë‹ˆë‹¤. ì‹¤ì† ë³´í—˜, ìƒí™œë³´ì¥í˜• ì¹´ë“œ, ë³µí•© í˜œíƒì´ í¬í•¨ëœ ìƒí’ˆì„ í†µí•´ ì‚¶ì˜ ë¦¬ìŠ¤í¬ë¥¼ ìµœì†Œí™”í•˜ë ¤ í•˜ë©°, íˆ¬ìë³´ë‹¤ëŠ” ìì‚° ë³´í˜¸ì™€ í˜„ê¸ˆ íë¦„ ê´€ë¦¬ì— ì´ˆì ì„ ë§ì¶¥ë‹ˆë‹¤. ê°ì •ì ì¸ ì†Œë¹„ë‚˜ ê³ ìœ„í—˜ íˆ¬ìì—ëŠ” ë¶€ë‹´ì„ ëŠë¼ë©°, ê±´ê°•ì´ë‚˜ ìƒí™œì•ˆì • ê°™ì€ í˜„ì‹¤ì ì¸ ìš”ì†Œë¥¼ ê³ ë ¤í•œ ê¸ˆìœµìƒí’ˆì„ ì„ í˜¸í•©ë‹ˆë‹¤.',
};

/* ========== ìœ í‹¸ ========== */
const scrollToBottom = () => {
  nextTick(() => {
    setTimeout(() => {
      if (chatBody.value)
        chatBody.value.scrollTop = chatBody.value.scrollHeight;
    }, 50);
  });
};
const fetchDefinitionFromGPT = async (term) => {
  try {
    const res = await axios.post('/api/chatbot', {
      message: `${term}ë¥¼(ì„) ê¸ˆìœµ ì´ˆë³´ìê°€ ì´í•´í•˜ê²Œ, ì •ì˜â†’ì™œ ì¤‘ìš”í•œì§€â†’ê°„ë‹¨ ì˜ˆì‹œ ìˆœì„œë¡œ 5ì¤„ ë‚´ ì„¤ëª…í•´ì¤˜.`,
      systemPrompt:
        'ë‹¹ì‹ ì€ ê¸ˆìœµ ì „ë¬¸ê°€ì…ë‹ˆë‹¤. ì‰¬ìš´ í•œêµ­ì–´ë¡œ, êµ°ë”ë”ê¸° ì—†ì´ ì¹œì ˆí•˜ê²Œ ì„¤ëª…í•˜ì„¸ìš”.',
    });
    const reply = res?.data?.reply?.trim();
    return reply && reply.length ? reply : 'ì„¤ëª…ì„ ê°€ì ¸ì˜¬ ìˆ˜ ì—†ì—ˆìŠµë‹ˆë‹¤.';
  } catch (e) {
    console.error(e);
    return 'ì„¤ëª…ì„ ê°€ì ¸ì˜¬ ìˆ˜ ì—†ì—ˆìŠµë‹ˆë‹¤.';
  }
};

const fetchSimplerDefinitionFromGPT = async (term) => {
  try {
    const res = await axios.post('/api/chatbot', {
      message: `ì´ˆë“±í•™ìƒì—ê²Œ ${term}ë¥¼(ì„) ì„¤ëª…í•˜ë“¯ ì•„ì£¼ ì‰½ê²Œ, ë¹„ìœ  1ê°œ í¬í•¨í•´ì„œ 3ë¬¸ì¥ìœ¼ë¡œ ì„¤ëª…í•´ì¤˜.`,
      systemPrompt:
        'ë‹¹ì‹ ì€ ì¹œì ˆí•œ ì„ ìƒë‹˜ì…ë‹ˆë‹¤. ì–´ë ¤ìš´ ìš©ì–´ ê¸ˆì§€, ì§§ê³  ì‰¬ìš´ ë¬¸ì¥.',
    });
    const reply = res?.data?.reply?.trim();
    return reply && reply.length
      ? reply
      : 'ë” ì‰½ê²Œ ì„¤ëª…ì„ ê°€ì ¸ì˜¬ ìˆ˜ ì—†ì—ˆìŠµë‹ˆë‹¤.';
  } catch (e) {
    console.error(e);
    return 'ë” ì‰½ê²Œ ì„¤ëª…ì„ ê°€ì ¸ì˜¬ ìˆ˜ ì—†ì—ˆìŠµë‹ˆë‹¤.';
  }
};

const formattedContent = (text) => {
  if (!text) return '';
  if (/<[a-z][\s\S]*>/i.test(text)) return text; // HTML í¬í•¨ ì‹œ ê·¸ëŒ€ë¡œ
  if (text.includes('\n')) return text.replace(/\n/g, '<br />');
  const sentences = text.split(/(?<=[.?!])\s+/);
  let result = '';
  for (let i = 0; i < sentences.length; i++) {
    result += sentences[i];
    result += (i + 1) % 2 === 0 ? '<br />' : ' ';
  }
  return result;
};
/* ì‹ ìš©ì¹´ë“œ ë§¤í•‘ */
const cardCreditMap = {
  ì¹´í˜: {
    id: 14, // ì‹ í•œì¹´ë“œ YOLO â“˜
    name: 'ì‹ í•œì¹´ë“œ YOLO â“˜',
    summary:
      'â˜• ì¹´í˜Â·ì™¸ì‹ ë“± ì¼ìƒ ì—¬ê°€ ì†Œë¹„ì— ì´ˆì ì„ ë§ì¶˜ ë¼ì¸ì—…ì…ë‹ˆë‹¤.\n' +
      'ë¸Œëœë“œê°€ ê³ ì •ë˜ì§€ ì•Šì•„ ë™ì„  ë”°ë¼ ììœ ë¡­ê²Œ ì“°ê¸° ì¢‹ê³ , ì†Œì•¡ ê²°ì œë„ ê¼¼ê¼¼íˆ ì ë¦½/í• ì¸ì´ ëˆ„ì ë¼ìš”.\n' +
      'ì‹¤ì  í”¼ë¡œê°ì´ ë‚®ì•„ â€œë§¤ì¼ í•œë‘ ì”â€ ê°™ì€ ë£¨í‹´ì—ì„œë„ í˜œíƒì„ ì²´ê°í•˜ê¸° ì‰½ìŠµë‹ˆë‹¤.\n' +
      'ê²°ë¡ : ì¹´í˜/ì™¸ì‹ ì¤‘ì‹¬ì˜ ê°€ë²¼ìš´ ë¼ì´í”„ìŠ¤íƒ€ì¼ì— ë§ì¶˜ ì‹¤ì† ì¹´ë“œ.',
  },
  ìŒì‹ì : {
    id: 477, // ì‹ í•œì¹´ë“œ Deep Taking
    name: 'ì‹ í•œì¹´ë“œ Deep Taking',
    summary:
      'ğŸ½ï¸ ì™¸ì‹Â·ë°°ë‹¬ ì†Œë¹„ê°€ ì¦ë‹¤ë©´ ê²°ì œí•  ë•Œë§ˆë‹¤ ì²´ê° ì ˆì•½ì„ ì£¼ëŠ” êµ¬ì„±ì…ë‹ˆë‹¤.\n' +
      'ë°°ë‹¬ì•±/í”„ëœì°¨ì´ì¦ˆ/ë™ë„¤ ì‹ë‹¹ ë“± ë²”ìš©ì„±ì´ ë†’ì•„ ì‹ì‚¬ ë™ì„ ì— ë§ì¶° í˜œíƒì„ ì±™ê¸°ê¸° ì‰¬ì›Œìš”.\n' +
      'ê²°ë¡ : â€œë°–ì—ì„œ ë¨¹ê³ , ê°€ë” ë°°ë‹¬â€ íŒ¨í„´ì— ë”± ë§ì¶˜ ì‹ì‚¬ ì „ìš© ì¹´ë“œ.',
  },
  êµí†µ: {
    id: 2559, // K-íŒ¨ìŠ¤ (ì‹ ìš©)
    name: 'K-íŒ¨ìŠ¤ (ì‹ ìš©)',
    summary:
      'ğŸšŒ ëŒ€ì¤‘êµí†µ/íƒì‹œ ì¤‘ì‹¬ ì´ë™ íŒ¨í„´ì„ ê²¨ëƒ¥í•œ êµí†µ íŠ¹í™” ì¹´ë“œì…ë‹ˆë‹¤.\n' +
      'ì¶œí‡´ê·¼ ê³ ì •ë¹„ë¥¼ ì•ˆì •ì ìœ¼ë¡œ ë‚®ì¶°ì£¼ê³ , ì†Œì•¡ ê²°ì œë¼ë„ ë§¤ì¼ ìŒ“ì´ëŠ” ëˆ„ì  ì ˆê°ì´ í½ë‹ˆë‹¤.\n' +
      'ê²°ë¡ : â€œêµí†µë¹„ê°€ ê³ ì •ë¹„â€ì¸ ë¶„ì—ê²Œ í™•ì‹¤í•œ íš¨ìš©.',
  },
  ì‡¼í•‘: {
    id: 2687, // ì¹´ë“œì˜ì •ì„ SHOPPING+
    name: 'ì¹´ë“œì˜ì •ì„ SHOPPING+',
    summary:
      'ğŸ›ï¸ ì˜¨Â·ì˜¤í”„ë¼ì¸ ì‡¼í•‘ ì „ë°˜ì„ ë„“ê²Œ ì»¤ë²„í•˜ëŠ” í• ì¸ê°€ë“œì…ë‹ˆë‹¤.\n' +
      'ëŒ€í˜•ë§ˆíŠ¸/í¸ì˜ì /ë“œëŸ­ìŠ¤í† ì–´/íŒ¨ì…˜ëª° ë“± ìƒí™œ ì‡¼í•‘ì„ í•œ ì¥ìœ¼ë¡œ ì •ë¦¬í•˜ê¸° ì¢‹ì•„ìš”.\n' +
      'ê²°ë¡ : ìƒí™œí˜• ì‡¼í•‘ì„ í­ë„“ê²Œ ì“°ëŠ” ì´ìš©ìì—ê²Œ ê· í˜• ì¢‹ì€ ì„ íƒ.',
  },
  ì˜¨ë¼ì¸êµ¬ë§¤: {
    id: 2609, // ì¿ íŒ¡ ì™€ìš°ì¹´ë“œ
    name: 'ì¿ íŒ¡ ì™€ìš°ì¹´ë“œ',
    summary:
      'ğŸ’» ì¿ íŒ¡ ì¤‘ì‹¬ì˜ ì˜¨ë¼ì¸ ì‡¼í•‘ì— ìµœì í™”ëœ ì¹´ë“œì…ë‹ˆë‹¤.\n' +
      'ìƒí•„í’ˆë¶€í„° ê°€ì „ê¹Œì§€ ì˜¨ë¼ì¸ ì¥ë°”êµ¬ë‹ˆ ë¹„ì¤‘ì´ í´ìˆ˜ë¡ ì²´ê° ì ˆì•½ì´ ì»¤ì ¸ìš”.\n' +
      'ê²°ë¡ : â€œì™€ìš° íšŒì› + ì˜¨ë¼ì¸ ì¼ìƒêµ¬ë§¤â€ ì¡°í•©ì— íŠ¹íˆ íš¨ìœ¨ì .',
  },
  í¸ì˜ì : {
    id: 52, // ì‚¼ì„±ì¹´ë“œ taptap S
    name: 'ì‚¼ì„±ì¹´ë“œ taptap S',
    summary:
      'ğŸª í¸ì˜ì /ìƒí™œí˜• ì†Œì•¡ ê²°ì œì— ê°•í•œ êµ¬ì„±ì…ë‹ˆë‹¤.\n' +
      'ë¸Œëœë“œ ê³ ì •ë„ê°€ ë‚®ì•„ CUÂ·GS25Â·ì„¸ë¸ì¼ë ˆë¸ ë“± ë™ì„ ëŒ€ë¡œ ì¨ë„ í˜œíƒì„ ì±™ê¸°ê¸° ì‰¬ì›Œìš”.\n' +
      'ê²°ë¡ : â€œìì˜í•˜ì§€ë§Œ ìì£¼â€ ê²°ì œ íŒ¨í„´ì—ì„œ ë¹›ë‚˜ëŠ” ì¹´ë“œ.',
  },
  ì˜í™”: {
    id: 2371, // ì‹ í•œì¹´ë“œ í”Œë¦¬
    name: 'ì‹ í•œì¹´ë“œ í”Œë¦¬',
    summary:
      'ğŸ¬ ì˜í™”/OTT/ì—”í„°í…Œì¸ë¨¼íŠ¸ ì†Œë¹„ë¥¼ ëª¨ì•„ í˜œíƒì„ ì£¼ëŠ” êµ¬ì„±ì…ë‹ˆë‹¤.\n' +
      'ì£¼ë§ ê´€ëŒ, OTT ì •ê¸°ê²°ì œ ë“± ì—¬ê°€ ë£¨í‹´ê³¼ ê²°í•©í•˜ë©´ ì²´ê° ì ˆì•½ì´ ì»¤ì ¸ìš”.\n' +
      'ê²°ë¡ : ì½˜í…ì¸  ì†Œë¹„ê°€ ì¼ìƒì¸ ë¶„ì—ê²Œ ì í•©í•œ ì—”í„° íŠ¹í™” ì¹´ë“œ.',
  },
  ì£¼ìœ : {
    id: 16, // ì‹ í•œì¹´ë“œ RPM+ Platinum#
    name: 'ì‹ í•œì¹´ë“œ RPM+ Platinum#',
    summary:
      'â›½ ë¦¬í„°ë‹¹ í˜œíƒ êµ¬ì¡°ë¡œ ì£¼í–‰ê±°ë¦¬ê°€ ê¸¸ìˆ˜ë¡ íš¨ìµì´ ì»¤ì§€ëŠ” ì£¼ìœ  íŠ¹í™” ì¹´ë“œì…ë‹ˆë‹¤.\n' +
      'ì„¸ì°¨/í¸ì˜ì‹œì„¤ ê²°ì œì™€ë„ ìì—°ìŠ¤ëŸ½ê²Œ ì–´ìš°ëŸ¬ì ¸ â€œì°¨ ìƒí™œ ì „ë°˜â€ ë¹„ìš©ì„ ë‚®ì¶œ ìˆ˜ ìˆì–´ìš”.\n' +
      'ê²°ë¡ : ì¶œí‡´ê·¼/ì¥ê±°ë¦¬ ìš´ì „ì— ì‹¤ì† ìˆëŠ” ì£¼ìœ  ì „ìš© ì„ íƒ.',
  },
  í•´ì™¸ê²°ì œ: {
    id: 12, // ì‹ í•œì¹´ë“œ Air Platinum#
    name: 'ì‹ í•œì¹´ë“œ Air Platinum#',
    summary:
      'ğŸŒ í•´ì™¸ ì˜¨Â·ì˜¤í”„ ê²°ì œ/ì—¬í–‰ ì‚¬ìš©ì„±ê¹Œì§€ ê³ ë ¤í•œ íŠ¸ë˜ë¸” ë¼ì¸ì—…ì…ë‹ˆë‹¤.\n' +
      'í•­ê³µ/ì—¬í–‰ ê²°ì œ ë£¨í‹´ê³¼ ê²°í•©í•˜ë©´ ì´ì†Œìœ ë¹„ìš©(TCO)ì„ ëˆˆì— ë„ê²Œ ë‚®ì¶œ ìˆ˜ ìˆì–´ìš”.\n' +
      'ê²°ë¡ : í•´ì™¸ì§êµ¬ + ì—¬í–‰ì„ í•¨ê»˜ ì¦ê¸°ëŠ” ì‚¬ìš©ìì—ê²Œ ìµœì .',
  },
  í†µì‹ ë¹„: {
    id: 41, // ì‹ í•œì¹´ë“œ Deep On Platinum+
    name: 'ì‹ í•œì¹´ë“œ Deep On Platinum+',
    summary:
      'ğŸ“± í†µì‹ ìš”ê¸ˆ/ë””ì§€í„¸ êµ¬ë… ê²°ì œ ë“± â€œê³ ì • êµ¬ë…í˜• ì§€ì¶œâ€ì„ ê²¨ëƒ¥í•œ êµ¬ì„±ì…ë‹ˆë‹¤.\n' +
      'ìë™ì´ì²´ë¡œ ì„¸íŒ…í•´ë‘ë©´ ì† ëŒˆ ì¼ ì—†ì´ ì›” ê³ ì •ë¹„ë¥¼ ì¤„ì¼ ìˆ˜ ìˆì–´ìš”.\n' +
      'ê²°ë¡ : í†µì‹ Â·êµ¬ë…ì„ ë¬¶ì–´ ê´€ë¦¬í•˜ëŠ” ë¶„ì—ê²Œ íš¨ìœ¨ì ì¸ ì¹´ë“œ.',
  },
  ê³µê³¼ê¸ˆ: {
    id: 13, // ì‹ í•œì¹´ë“œ Mr.Life
    name: 'ì‹ í•œì¹´ë“œ Mr.Life',
    summary:
      'ğŸ’¡ ì „ê¸°/ê°€ìŠ¤/ìˆ˜ë„ ë“± ê³µê³¼ê¸ˆê³¼ ìƒí™œìš”ê¸ˆ ìµœì í™”ì— íŠ¹í™”ëœ ì¹´ë“œì…ë‹ˆë‹¤.\n' +
      'ì›” ê³ ì •ë¹„ ë¹„ì¤‘ì´ ë†’ì„ìˆ˜ë¡ ì²´ê° ì ˆì•½ì´ í¬ê²Œ ëˆ„ì ë¼ìš”.\n' +
      'ê²°ë¡ : ìƒí™œë¹„ êµ¬ì¡°ê°€ ë‹¨ë‹¨í•œ ê°€êµ¬ì˜ â€œê³ ì •ë¹„ ì ˆê°â€ ì¹´ë“œ.',
  },
};

/* ì²´í¬ì¹´ë“œ ë§¤í•‘ */
const cardCheckMap = {
  ì¹´í˜: {
    id: 646, // ì‹ í•œì¹´ë“œ Deep Dream ì²´í¬(ë¯¸ë‹ˆì–¸ì¦ˆ)
    name: 'ì‹ í•œì¹´ë“œ Deep Dream ì²´í¬(ë¯¸ë‹ˆì–¸ì¦ˆ)',
    summary:
      'â˜• ì†Œì•¡ ì¹´í˜ ê²°ì œë¥¼ ìì£¼ í•˜ëŠ” ì‚¬ìš©ìì—ê²Œ ì˜ ë§ëŠ” ì²´í¬ì¹´ë“œì…ë‹ˆë‹¤.\n' +
      'í”„ëœì°¨ì´ì¦ˆ/ê°œì¸ ì¹´í˜ë¥¼ ê°€ë¦¬ì§€ ì•Šê³  ì¼ìƒ ê²°ì œì—ì„œ í­ë„“ê²Œ ì“°ê¸° ì‰¬ì›Œìš”.\n' +
      'ê²°ë¡ : â€œì‘ì§€ë§Œ ìì£¼â€ ê²°ì œ íŒ¨í„´ì— ì¶©ì‹¤í•œ ì²´í¬ ì„ íƒ.',
  },
  ìŒì‹ì : {
    id: 351, // ìŠ¤íƒ€ì²´í¬ì¹´ë“œ
    name: 'ìŠ¤íƒ€ì²´í¬ì¹´ë“œ',
    summary:
      'ğŸ½ï¸ ì™¸ì‹Â·ê°„ì‹ ë“± ì‹ì‚¬ ë™ì„ ì—ì„œ ê°€ë³ê²Œ ì“°ê¸° ì¢‹ì€ ë²”ìš©í˜• ì²´í¬ì¹´ë“œì…ë‹ˆë‹¤.\n' +
      'í•œ ì¥ìœ¼ë¡œ ì¼ìƒ ê²°ì œë¥¼ ì •ë¦¬í•˜ê³  ì‹¶ì€ ì‚¬ìš©ìì—ê²Œ ë¬´ë‚œí•´ìš”.\n' +
      'ê²°ë¡ : ì™¸ì‹ ë¹„ì¤‘ì´ ë†’ì€ ë¶„ì˜ ê¸°ë³¸ê¸° ì²´í¬.',
  },
  êµí†µ: {
    id: 2422, // ë…¸ë¦¬2 ì²´í¬ì¹´ë“œ(KB Pay)
    name: 'ë…¸ë¦¬2 ì²´í¬ì¹´ë“œ(KB Pay)',
    summary:
      'ğŸšŒ ëŒ€ì¤‘êµí†µ/íƒì‹œ ë“± ì´ë™ë¹„ ì§€ì¶œì— ì´ˆì ì„ ë§ì¶˜ ìƒí™œí˜• ì²´í¬ì¹´ë“œì…ë‹ˆë‹¤.\n' +
      'ì¶œí‡´ê·¼ ê³ ì •ë¹„ì— ì¶©ì‹¤í•´ ë§¤ë‹¬ ì²´ê° ì ˆì•½ì„ ì£¼ê¸° ì¢‹ì•„ìš”.\n' +
      'ê²°ë¡ : êµí†µë¹„ ìµœì í™”ê°€ í•„ìš”í•œ í†µê·¼ì¡±ì—ê²Œ ì í•©.',
  },
  ì‡¼í•‘: {
    id: 2810, // ë” ì‹¬í”Œ ì²´í¬ì¹´ë“œ
    name: 'ë” ì‹¬í”Œ ì²´í¬ì¹´ë“œ',
    summary:
      'ğŸ›ï¸ ì˜¨Â·ì˜¤í”„ ì‡¼í•‘ì„ ê°€ë³ê²Œ ì»¤ë²„í•˜ëŠ” ê¸°ë³¸í˜• ì²´í¬ì…ë‹ˆë‹¤.\n' +
      'ë³µì¡í•œ ì‹¤ì  ê´€ë¦¬ ì—†ì´ ì¼ìƒ ê²°ì œì—ì„œ ë‘ë£¨ ì“°ê¸° ì¢‹ì•„ìš”.\n' +
      'ê²°ë¡ : â€œê°„ë‹¨í•˜ê²Œ í•œ ì¥â€ì„ ì›í•˜ëŠ” ì‚¬ìš©ìì—ê²Œ ì¶”ì²œ.',
  },
  ì˜¨ë¼ì¸êµ¬ë§¤: {
    id: 286, // ì¹´ì¹´ì˜¤í˜ì´ ì‹ í•œ ì²´í¬ì¹´ë“œ
    name: 'ì¹´ì¹´ì˜¤í˜ì´ ì‹ í•œ ì²´í¬ì¹´ë“œ',
    summary:
      'ğŸ’» ì¹´ì¹´ì˜¤í˜ì´/ê°„í¸ê²°ì œ ì¤‘ì‹¬ ì˜¨ë¼ì¸ ì‡¼í•‘ì— ê°•ì ì´ ìˆëŠ” ì²´í¬ì¹´ë“œì…ë‹ˆë‹¤.\n' +
      'ëª¨ë°”ì¼ ê²°ì œ ë£¨í‹´ê³¼ ê¶í•©ì´ ì¢‹ì•„ ìŠ¤ë§ˆíŠ¸í° í•˜ë‚˜ë¡œ ì†Œë¹„ë¥¼ ì •ë¦¬í•  ìˆ˜ ìˆì–´ìš”.\n' +
      'ê²°ë¡ : ê°„í¸ê²°ì œ/ì˜¨ë¼ì¸ ì¤‘ì‹¬ ì†Œë¹„ìì—ê²Œ ìµœì .',
  },
  í¸ì˜ì : {
    id: 2749, // ONE ì²´í¬ì¹´ë“œ
    name: 'ONE ì²´í¬ì¹´ë“œ',
    summary:
      'ğŸª í¸ì˜ì /ìƒí™œ ì†Œì•¡ ê²°ì œë¥¼ ë„“ê²Œ ì»¤ë²„í•˜ëŠ” ë²”ìš©í˜• ì²´í¬ì¹´ë“œì…ë‹ˆë‹¤.\n' +
      'ë¸Œëœë“œ ì œí•œì´ ë‚®ì•„ ë™ì„  ë”°ë¼ ì“°ê¸° ì¢‹ì•„ìš”.\n' +
      'ê²°ë¡ : ìì˜í•œ ê²°ì œê°€ ì¦ì€ ì‚¬ìš©ìì—ê²Œ ì‹¤ì† ìˆëŠ” ì¹´ë“œ.',
  },
  ì˜í™”: {
    id: 2852, // KB í‹´ì—… ì²´í¬ì¹´ë“œ
    name: 'KB í‹´ì—… ì²´í¬ì¹´ë“œ',
    summary:
      'ğŸ¬ í•™ìƒÂ·ì²­ë…„ì¸µì˜ ì˜í™”/ë¬¸í™” ì†Œë¹„ë¥¼ ì—¼ë‘ì— ë‘” êµ¬ì„±ì…ë‹ˆë‹¤.\n' +
      'ê·¹ì¥ ê´€ëŒ/ë¬¸í™”ìƒí™œì„ ê°€ë³ê²Œ ì¦ê¸°ëŠ” ì‚¬ìš©ìì—ê²Œ ì–´ìš¸ë¦½ë‹ˆë‹¤.\n' +
      'ê²°ë¡ : ì˜í™”Â·ë¬¸í™” ì…ë¬¸ììš© ê¸°ë³¸ ì²´í¬.',
  },
  ì£¼ìœ : {
    id: 2332, // KBêµ­ë¯¼ ìš°ë¦¬ë™ë„¤ ì²´í¬ì¹´ë“œ
    name: 'KBêµ­ë¯¼ ìš°ë¦¬ë™ë„¤ ì²´í¬ì¹´ë“œ',
    summary:
      'â›½ ë™ë„¤ ê¸°ë°˜ ìƒí™œ ê²°ì œ(ì£¼ìœ /ë§ˆíŠ¸/í¸ì˜ì  ë“±)ë¥¼ ë¬¶ì–´ ì“°ê¸° ì¢‹ì€ ì²´í¬ì…ë‹ˆë‹¤.\n' +
      'ì£¼ìœ  ë¹„ì¤‘ì´ ìˆëŠ” ìš´ì „ìì˜ ìƒí™œíŒ¨í„´ê³¼ ê¶í•©ì´ ì¢‹ì•„ìš”.\n' +
      'ê²°ë¡ : ê·¼ê±°ë¦¬ ìƒí™œê¶Œì—ì„œ í­ë„“ê²Œ ì“°ëŠ” ì²´í¬.',
  },
  í•´ì™¸ê²°ì œ: {
    id: 2691, // íŠ¸ë˜ë¸”ëŸ¬ìŠ¤ ì²´í¬ì¹´ë“œ
    name: 'íŠ¸ë˜ë¸”ëŸ¬ìŠ¤ ì²´í¬ì¹´ë“œ',
    summary:
      'ğŸŒ í•´ì™¸ì—¬í–‰Â·í•´ì™¸ê²°ì œì— íŠ¹í™”ëœ ì²´í¬ì¹´ë“œì…ë‹ˆë‹¤.\n' +
      'ì—¬í–‰ ê²½ë¹„/ì§êµ¬ ê²°ì œê¹Œì§€ í•œ ì¥ìœ¼ë¡œ ê²½í—˜ì„ ë‹¨ìˆœí™”í•  ìˆ˜ ìˆì–´ìš”.\n' +
      'ê²°ë¡ : ì—¬í–‰/ì§êµ¬ë¥¼ ì¦ê¸°ëŠ” ì‚¬ìš©ìì—ê²Œ ë§ì¶¤.',
  },
  í†µì‹ ë¹„: {
    id: 2338, // ì‹ í•œì¹´ë“œ Way ì²´í¬
    name: 'ì‹ í•œì¹´ë“œ Way ì²´í¬',
    summary:
      'ğŸ“± í†µì‹ ìš”ê¸ˆ/ë””ì§€í„¸ êµ¬ë… ê°™ì€ ê³ ì •ë¹„ë¥¼ ì²´í¬ì¹´ë“œë¡œ ê´€ë¦¬í•˜ê³  ì‹¶ë‹¤ë©´ ì í•©í•©ë‹ˆë‹¤.\n' +
      'ìë™ì´ì²´ì™€ ì¡°í•©í•˜ë©´ â€œì†Œë¹„ ì „ì— ì €ì¶•â€ ë£¨í‹´ ë§Œë“¤ê¸°ë„ ì‰¬ì›Œìš”.\n' +
      'ê²°ë¡ : ê³ ì •ë¹„ë¥¼ ì²´í¬ë¡œ ê´€ë¦¬í•˜ë ¤ëŠ” ì‚¬ìš©ìì—ê²Œ ì¶”ì²œ.',
  },
  ê³µê³¼ê¸ˆ: {
    id: 350, // ì§ì¥ì¸ë³´ë„ˆìŠ¤ì²´í¬ì¹´ë“œ
    name: 'ì§ì¥ì¸ë³´ë„ˆìŠ¤ì²´í¬ì¹´ë“œ',
    summary:
      'ğŸ’¡ ì „ê¸°/ê°€ìŠ¤/ìˆ˜ë„ ë“± ê³µê³¼ê¸ˆ ìë™ì´ì²´ ì¤‘ì‹¬ ì‚¬ìš©ìì—ê²Œ ìœ ìš©í•©ë‹ˆë‹¤.\n' +
      'ê³ ì •ë¹„ ì§€ì¶œì„ ì²´í¬ë¡œ í†µì œí•˜ë©´ì„œ ê°„ë‹¨íˆ ê´€ë¦¬í•  ìˆ˜ ìˆì–´ìš”.\n' +
      'ê²°ë¡ : ìƒí™œìš”ê¸ˆ ìµœì í™”ë¥¼ ì›í•˜ëŠ” ì§ì¥ì¸ì—ê²Œ ì í•©.',
  },
};

const showCardRecommendation = async (category) => {
  const map =
    selectedCardType.value === 'ì²´í¬ì¹´ë“œ' ? cardCheckMap : cardCreditMap;
  const rec = map[category];
  if (!rec) {
    await sendBotMessage(
      'ì´ ì¹´í…Œê³ ë¦¬ì— ëŒ€í•œ ë§¤í•‘ ì •ë³´ê°€ ì—†ì–´ìš”. ë‹¤ë¥¸ í•­ëª©ì„ ì„ íƒí•´ ì£¼ì„¸ìš”!'
    );
    return;
  }
  await sendBotMessage(`${rec.summary}\n\nì¶”ì²œ ì¹´ë“œ: ${rec.name}`);
  // ìƒì„¸ ë³´ê¸° CTA (router ì´ë™)
  ctas.value = [
    { label: `${rec.name} ìƒì„¸ ë³´ê¸°`, route: `/detail/card/${rec.id}` },
  ];
};
/* =========================
 * ì˜ˆê¸ˆ ì¶”ì²œ ë§¤í•‘ (ì¹´í…Œê³ ë¦¬ â†’ ìƒí’ˆ 1ê°œ)
 * ========================= */
const depositRecommendations = {
  'ë‹¨ê¸° ì—¬ìœ ìê¸ˆ': {
    id: 34, // ì½”ë“œK ì •ê¸°ì˜ˆê¸ˆ
    name: 'ì½”ë“œK ì •ê¸°ì˜ˆê¸ˆ',
    summary:
      'ğŸ’¸ ë‹¨ê¸°(3~6ê°œì›”)ë¡œ ì ê¹ êµ´ë¦´ ìê¸ˆì´ë¼ë©´, ê¸ˆë¦¬ì™€ ìœ ì—°ì„±ì˜ ê· í˜•ì´ ì¤‘ìš”í•©ë‹ˆë‹¤.\n' +
      'ì½”ë“œK ì •ê¸°ì˜ˆê¸ˆì€ ë¹„ëŒ€ë©´ ê°€ì…ì´ ê°„í¸í•˜ê³ , ê°€ì…/í•´ì§€ ì ˆì°¨ê°€ ë‹¨ìˆœí•´ â€œì ê¹ ë¬¶ì–´ë‘ëŠ”â€ ìš´ìš©ì— ì˜ ë§ìŠµë‹ˆë‹¤.\n' +
      'ì…ì¶œê¸ˆ í†µì¥ ëŒ€ë¹„ í™•ì‹¤íˆ ë†’ì€ ì´ìë¥¼ í™•ë³´í•˜ë©´ì„œë„ ê¸°ê°„ ë¶€ë‹´ì´ ì ê³ , ì¤‘ë„í•´ì§€ ì‹œ ì´ìœ¨ ì•ˆë‚´ê°€ ëª…í™•í•´ ë¦¬ìŠ¤í¬ ê´€ë¦¬ê°€ ì‰¬ì›Œìš”.\n' +
      'ê²°ë¡ : 3~6ê°œì›” êµ´ë¦¬ê¸° ì¢‹ì€ ê¹”ë”í•œ ë‹¨ê¸° ì˜ˆê¸ˆ.\n' +
      'ì¶”ì²œ ìƒí’ˆ: ì½”ë“œK ì •ê¸°ì˜ˆê¸ˆ',
  },
  'ê²°í˜¼ìê¸ˆ(ì˜ˆê¸ˆ)': {
    id: 1, // WONí”ŒëŸ¬ìŠ¤ì˜ˆê¸ˆ
    name: 'WONí”ŒëŸ¬ìŠ¤ì˜ˆê¸ˆ',
    summary:
      'ğŸ’ ê²°í˜¼ ì¤€ë¹„ì²˜ëŸ¼ â€œëª©í‘œ ì‹œì ì´ í™•ì‹¤í•œâ€ ìê¸ˆì—ëŠ” ì•ˆì •ì ì¸ ì •ê¸°ì˜ˆê¸ˆì´ ì í•©í•©ë‹ˆë‹¤.\n' +
      'WONí”ŒëŸ¬ìŠ¤ì˜ˆê¸ˆì€ ëª¨ë°”ì¼ë¡œ ê°€ì…/ê´€ë¦¬í•˜ê¸° ì‰½ê³ , ê¸‰ì—¬ì´ì²´Â·ìë™ì´ì²´ ë“± ìƒí™œ ë£¨í‹´ê³¼ ì—°ë™í•œ ìš°ëŒ€ ì¡°ê±´ì„ ë¶™ì´ë©´ ì‹¤ê¸ˆë¦¬ë¥¼ ë†’ì´ê¸° ìˆ˜ì›”í•´ìš”.\n' +
      'ëª©ëˆì„ ì•ˆì „í•˜ê²Œ ë³´ì „í•˜ë©´ì„œ, ì˜ˆì‹/ì‹ í˜¼ì§‘ ê³„ì•½ ë“± í° ì§€ì¶œ ì¼ì •ì— ë§ì¶° ë§Œê¸° ìê¸ˆì„ í™•ë³´í•˜ê¸° ì¢‹ìŠµë‹ˆë‹¤.\n' +
      'ê²°ë¡ : ì•ˆì •ì„± ìµœìš°ì„ ì˜ ì¥ê¸° ëª©í‘œ ì˜ˆì¹˜ì— ì í•©.\n' +
      'ì¶”ì²œ ìƒí’ˆ: WONí”ŒëŸ¬ìŠ¤ì˜ˆê¸ˆ',
  },
  ë…¸í›„ìê¸ˆ: {
    id: 23, // IBKí‰ìƒí•œê°€ì¡±í†µì¥(ì‹¤ì„¸ê¸ˆë¦¬ì •ê¸°ì˜ˆê¸ˆ)
    name: 'IBKí‰ìƒí•œê°€ì¡±í†µì¥(ì‹¤ì„¸ê¸ˆë¦¬ì •ê¸°ì˜ˆê¸ˆ)',
    summary:
      'ğŸ‘µ ë…¸í›„ìê¸ˆì€ â€œì•ˆì •ì„± + í˜„ê¸ˆíë¦„ ê´€ë¦¬(ì´ì ì§€ê¸‰ ì£¼ê¸°)â€ê°€ í•µì‹¬ì…ë‹ˆë‹¤.\n' +
      'IBKí‰ìƒí•œê°€ì¡±í†µì¥ì€ ì˜ˆê¸ˆì ë³´í˜¸ ë²”ìœ„ ë‚´ì—ì„œ ìš´ìš©í•˜ë©°, ì´ì ìˆ˜ë ¹ ì£¼ê¸°ë¥¼ ìƒí™œ íŒ¨í„´ì— ë§ì¶° ì„ íƒí•  ìˆ˜ ìˆì–´\n' +
      'ìƒí™œë¹„ íë¦„ì„ ê³„íšì ìœ¼ë¡œ ë§ì¶”ê¸° ì¢‹ìŠµë‹ˆë‹¤. ë³´ìˆ˜ì  ìš´ìš©ì„ ì›í•˜ëŠ” ë¶„ê»˜ ì˜ ë§ì•„ìš”.\n' +
      'ê²°ë¡ : ì¥ê¸° ì•ˆì •ì„±ê³¼ í˜„ê¸ˆíë¦„ì„ ë™ì‹œì— ì±™ê¸°ëŠ” ë…¸í›„ ë² ì´ìŠ¤ìº í”„.\n' +
      'ì¶”ì²œ ìƒí’ˆ: IBKí‰ìƒí•œê°€ì¡±í†µì¥(ì‹¤ì„¸ê¸ˆë¦¬ì •ê¸°ì˜ˆê¸ˆ)',
  },
  'ìƒì—¬ê¸ˆ êµ´ë¦¬ê¸°': {
    id: 17, // JB ë‹¤ì´ë ‰íŠ¸ì˜ˆê¸ˆí†µì¥(ë§Œê¸°ì¼ì‹œì§€ê¸‰ì‹)
    name: 'JB ë‹¤ì´ë ‰íŠ¸ì˜ˆê¸ˆí†µì¥(ë§Œê¸°ì¼ì‹œì§€ê¸‰ì‹)',
    summary:
      'ğŸ’¼ ìƒì—¬ê¸ˆÂ·ë³´ë„ˆìŠ¤ì²˜ëŸ¼ â€œì¼ì‹œê¸ˆâ€ì€ ê°€ì… ë¬¸í„± ë‚®ê³  ì˜¨ë¼ì¸ìœ¼ë¡œ ë¹ ë¥´ê²Œ ê°€ì…ë˜ëŠ” ì˜ˆê¸ˆì´ í¸í•©ë‹ˆë‹¤.\n' +
      'JB ë‹¤ì´ë ‰íŠ¸ì˜ˆê¸ˆí†µì¥ì€ ë¹„ëŒ€ë©´ ì „ìš©ìœ¼ë¡œ ê¸ˆë¦¬/ê¸°ê°„ ì„ íƒì´ ë‹¨ìˆœí•´, 3~12ê°œì›” ì‚¬ì´ â€œì ê¹â€ êµ´ë¦¬ê¸°ì— ì¢‹ì•„ìš”.\n' +
      'ëª©ëˆì„ ê°€ë³ê²Œ ë¬¶ì–´ë‘ê³  ë§Œê¸°ì— ì´ìë¥¼ í•œ ë²ˆì— ìˆ˜ë ¹í•˜ëŠ” êµ¬ì¡°ë¼, ì‚¬ìš© ì‹œì ì´ ëšœë ·í•  ë•Œ ìœ ë¦¬í•©ë‹ˆë‹¤.\n' +
      'ê²°ë¡ : ë‹¨ê¸°-ì¤‘ê¸° ì¼ì‹œê¸ˆ êµ´ë¦¬ê¸°ì— íŠ¹í™”ëœ ê°„í¸ ì˜ˆê¸ˆ.\n' +
      'ì¶”ì²œ ìƒí’ˆ: JB ë‹¤ì´ë ‰íŠ¸ì˜ˆê¸ˆí†µì¥(ë§Œê¸°ì¼ì‹œì§€ê¸‰ì‹)',
  },
  'ì•ˆì „í•œ ëª©ëˆê´€ë¦¬': {
    id: 27, // KB Star ì •ê¸°ì˜ˆê¸ˆ
    name: 'KB Star ì •ê¸°ì˜ˆê¸ˆ',
    summary:
      'ğŸ”’ ì›ê¸ˆë³´ì „ê³¼ ì˜ˆê¸ˆìë³´í˜¸ë¥¼ ìµœìš°ì„ ìœ¼ë¡œ í•  ë•ŒëŠ” í‘œì¤€í˜• ì •ê¸°ì˜ˆê¸ˆì´ ì •ë‹µì…ë‹ˆë‹¤.\n' +
      'KB Star ì •ê¸°ì˜ˆê¸ˆì€ ì§€ì /ëª¨ë°”ì¼ ì ‘ê·¼ì„±ì´ ì¢‹ì•„ ê´€ë¦¬ê°€ ì‰½ê³ , ê¸ˆë¦¬Â·ë§Œê¸° êµ¬ì¡°ê°€ ë‹¨ìˆœí•´ ìš´ì˜ ì‹¤ìˆ˜ê°€ ì ì–´ìš”.\n' +
      'ì¥ê¸° ë³´ê´€ìš© ëª©ëˆì˜ â€œê¸°ë³¸ ê·¸ë¦‡â€ìœ¼ë¡œ ì“°ê¸° ì¢‹ì€, ë¯¿ê³  ê°€ëŠ” ë² ì´ìŠ¤ ìƒí’ˆì…ë‹ˆë‹¤.\n' +
      'ê²°ë¡ : ì•ˆì •ì„± 1ìˆœìœ„ì˜ ê¸°ë³¸ê¸° ì •ê¸°ì˜ˆê¸ˆ.\n' +
      'ì¶”ì²œ ìƒí’ˆ: KB Star ì •ê¸°ì˜ˆê¸ˆ',
  },
};

/* =========================
 * ì ê¸ˆ ì¶”ì²œ ë§¤í•‘ (ì¹´í…Œê³ ë¦¬ â†’ ìƒí’ˆ 1ê°œ)
 * ì£¼ì‹  ID/ì´ë¦„ ê·¸ëŒ€ë¡œ ì‚¬ìš©
 * ========================= */
const savingRecommendations = {
  ì—¬í–‰ìê¸ˆ: {
    id: 12, // í•´í”¼ë¼ì´í”„_ì—¬í–‰ìŠ¤ì¼€ì¹˜ì ê¸ˆV
    name: 'í•´í”¼ë¼ì´í”„_ì—¬í–‰ìŠ¤ì¼€ì¹˜ì ê¸ˆV',
    summary:
      'âœˆï¸ ì—¬í–‰ ì¼ì •ì´ ì¡í˜€ ìˆë‹¤ë©´, ëª©í‘œ ì‹œì ì— ë§ì¶˜ ë‹¨Â·ì¤‘ê¸° ì ê¸ˆì´ ê°€ì¥ ì‹¤ìš©ì ì…ë‹ˆë‹¤.\n' +
      'ì—¬í–‰ ê²½ë¹„ëŠ” í•­ê³µê¶ŒÂ·ìˆ™ë°•Â·ì•¡í‹°ë¹„í‹°ì²˜ëŸ¼ ì§€ì¶œ íƒ€ì´ë°ì´ ëšœë ·í•˜ê¸° ë•Œë¬¸ì—, ë§¤ë‹¬ ì¼ì • ê¸ˆì•¡ì„ ì°¨ê³¡ì°¨ê³¡ ëª¨ìœ¼ë©´ì„œ í•„ìš”í•œ ìˆœê°„ì— ë§ì¶° ìê¸ˆì„ í™•ë³´í•˜ëŠ” ê²Œ ì¢‹ì•„ìš”.\n' +
      'ê°„ë‹¨í•œ ìš°ëŒ€ì¡°ê±´(ì•± ë¡œê·¸ì¸, ìë™ì´ì²´ ë“±)ì„ ì¡°í•©í•˜ë©´ ì‹¤ê¸ˆë¦¬ë¥¼ ëŒì–´ì˜¬ë¦¬ê¸° ì‰¬ì›Œ, â€œê³„íší•œ ë§Œí¼â€ ëˆì´ ìë¼ë‚˜ëŠ” ëŠë‚Œì„ ë°›ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.\n' +
      'ê²°ë¡ : ì—¬í–‰ ë°ë“œë¼ì¸ì— ì°©ë¶™ì¸ ëª©ì í˜• ì ê¸ˆ.\n' +
      'ì¶”ì²œ ìƒí’ˆ: í•´í”¼ë¼ì´í”„_ì—¬í–‰ìŠ¤ì¼€ì¹˜ì ê¸ˆV',
  },
  ìì·¨ë¹„ìš©: {
    id: 2, // WONì ê¸ˆ
    name: 'WONì ê¸ˆ',
    summary:
      'ğŸ  ì›”ì„¸Â·ê´€ë¦¬ë¹„Â·ìƒí™œë¹„ì²˜ëŸ¼ ë§¤ë‹¬ ë¹ ì ¸ë‚˜ê°€ëŠ” ê³ ì •ì§€ì¶œì„ ëŒ€ë¹„í•˜ë ¤ë©´ ì •ì•¡ ì ë¦½ì´ ê°€ì¥ ê¹”ë”í•©ë‹ˆë‹¤.\n' +
      'ê¸‰ì—¬ì¼ ë‹¤ìŒ ë‚ ì„ ë‚©ì…ì¼ë¡œ ì¡ì•„ â€œë¨¼ì € ì €ì¶•, ë‚˜ë¨¸ì§€ ì†Œë¹„â€ ë£¨í‹´ì„ ë§Œë“¤ë©´, ìƒí™œ íŒ¨í„´ì´ ííŠ¸ëŸ¬ì ¸ë„ ì €ì¶•ì€ ìë™ìœ¼ë¡œ êµ´ëŸ¬ê°€ìš”.\n' +
      'ìš°ëŒ€ì¡°ê±´ì´ ê³¼í•˜ì§€ ì•Šì•„ ì¥ê¸° ìœ ì§€ í”¼ë¡œë„ê°€ ë‚®ê³ , ëª¨ë°”ì¼ ê´€ë¦¬ê°€ ì‰¬ì›Œ ì¼ìƒ ì†ì—ì„œ ê¾¸ì¤€íˆ ì´ì–´ê°€ê¸° ì¢‹ìŠµë‹ˆë‹¤.\n' +
      'ê²°ë¡ : ìì·¨ í•„ìˆ˜ì§€ì¶œì„ â€˜ë¨¼ì € ì±™ê¸°ëŠ”â€™ ìƒí™œí˜• ì ê¸ˆ.\n' +
      'ì¶”ì²œ ìƒí’ˆ: WONì ê¸ˆ',
  },
  ë¹„ìƒê¸ˆ: {
    id: 50, // ì¹´ì¹´ì˜¤ë±…í¬ ììœ ì ê¸ˆ
    name: 'ì¹´ì¹´ì˜¤ë±…í¬ ììœ ì ê¸ˆ',
    summary:
      'ğŸš¨ ì˜ˆìƒì¹˜ ëª»í•œ ì§€ì¶œì— ëŒ€ë¹„í•˜ë ¤ë©´ ìœ ì—°í•œ â€œììœ ì ë¦½ì‹â€ì´ ë”±ì…ë‹ˆë‹¤.\n' +
      'ì—¬ìœ  ìˆì„ ë•ŒëŠ” ë§ì´, ë¹ ë“¯í•œ ë‹¬ì€ ì ê²Œ ë„£ì–´ë„ ê³„íšì´ ìœ ì§€ë˜ê¸° ë•Œë¬¸ì—, ë¹„ìƒê¸ˆ ë³¸ì—°ì˜ ëª©ì (ì–¸ì œë“  êº¼ë‚´ ì“¸ ì¤€ë¹„)ì— ì˜ ë§ì•„ìš”.\n' +
      'ëª¨ë°”ì¼ì—ì„œ ë‚©ì…Â·ë³€ê²½Â·í•´ì§€ê¹Œì§€ ê°„ë‹¨íˆ ê´€ë¦¬í•  ìˆ˜ ìˆì–´ ì ‘ê·¼ì„±ì´ ë›°ì–´ë‚©ë‹ˆë‹¤.\n' +
      'ê²°ë¡ : íƒ„ë ¥ ìˆê²Œ ìŒ“ëŠ” ì•ˆì „ë§ ì ê¸ˆ.\n' +
      'ì¶”ì²œ ìƒí’ˆ: ì¹´ì¹´ì˜¤ë±…í¬ ììœ ì ê¸ˆ',
  },
  'ê²°í˜¼ìê¸ˆ(ì ê¸ˆ)': {
    id: 32, // KBêµ­ë¯¼í”„ë¦¬ë¯¸ì—„ì ê¸ˆ(ì •ì•¡)
    name: 'KBêµ­ë¯¼í”„ë¦¬ë¯¸ì—„ì ê¸ˆ(ì •ì•¡)',
    summary:
      'ğŸ’ ì˜ˆì‹ì¥ ê³„ì•½, í˜¼ìˆ˜Â·ì˜ˆë¬¼, ì‹ í˜¼ì—¬í–‰ ë“± í° ì§€ì¶œì´ ì´ì–´ì§€ëŠ” ê²°í˜¼ ì¤€ë¹„ì—ëŠ” â€œì •ì•¡Â·ì¥ê¸°â€ë¡œ ê¾¸ì¤€íˆ í‚¤ìš°ëŠ” ì „ëµì´ íš¨ìœ¨ì ì…ë‹ˆë‹¤.\n' +
      'ëª©í‘œ ê¸°ê°„ì„ 24ê°œì›” ì´ìƒìœ¼ë¡œ ë‘ê³  ì›” ë‚©ì…ì•¡ì„ ë¬´ë¦¬ ì—†ëŠ” ìˆ˜ì¤€ìœ¼ë¡œ ê³ ì •í•˜ë©´, ëª©í‘œ ì‹œì ì— ì™„ì„±ëœ ìê¸ˆì„ ì•ˆì •ì ìœ¼ë¡œ í™•ë³´í•  ìˆ˜ ìˆì–´ìš”.\n' +
      'ìš°ëŒ€ì¡°ê±´ì„ ê²°í•©í•˜ë©´ ì‹¤ìˆ˜ë ¹ ì´ìë„ ì»¤ì ¸ ì²´ê° ì„±ì·¨ê°ì´ ì¢‹ìŠµë‹ˆë‹¤.\n' +
      'ê²°ë¡ : ì¥ê¸°Â·ëª©í‘œí˜•ì— ìµœì í™”ëœ ê²°í˜¼ ì¤€ë¹„ ì ê¸ˆ.\n' +
      'ì¶”ì²œ ìƒí’ˆ: KBêµ­ë¯¼í”„ë¦¬ë¯¸ì—„ì ê¸ˆ(ì •ì•¡)',
  },
  'ì‹ í˜¼ì§‘ ìê¸ˆ': {
    id: 42, // ì£¼ê±°ë˜í•˜ë‚˜ ì›”ë³µë¦¬ì ê¸ˆ
    name: 'ì£¼ê±°ë˜í•˜ë‚˜ ì›”ë³µë¦¬ì ê¸ˆ',
    summary:
      'ğŸ¡ ë³´ì¦ê¸ˆÂ·ì¤‘ë„ê¸ˆ ë“± â€œë©ì¹˜ í° ì§€ì¶œâ€ì„ ì•ë‘” ì‹ í˜¼ì§‘ ì¤€ë¹„ì—ëŠ” ë³µë¦¬ì˜ í˜ì´ ê¾¸ì¤€íˆ ìŒ“ì´ëŠ” êµ¬ì„±ì´ ìœ ë¦¬í•©ë‹ˆë‹¤.\n' +
      'ì›”ë³µë¦¬ëŠ” ë‚©ì… ì›ê¸ˆê³¼ ì´ìê°€ í•¨ê»˜ ë¶ˆì–´ë‚˜ ì¥ê¸°ì¼ìˆ˜ë¡ ì²´ê° íš¨ê³¼ê°€ ì»¤ì§€ê³ , ê¸‰ì—¬ì´ì²´Â·ìë™ì´ì²´ ê°™ì€ ë£¨í‹´ì„ ì–¹ìœ¼ë©´ ì‹¤ê¸ˆë¦¬ë„ ìì—°ìŠ¤ë ˆ ì˜¬ë¼ê°‘ë‹ˆë‹¤.\n' +
      'ì „ì„¸Â·ì²­ì•½ ë“± ì£¼ê±° ê³„íšê³¼ ë³‘í–‰ ì „ëµì„ ì„¸ìš°ê¸°ì—ë„ ì¢‹ìŠµë‹ˆë‹¤.\n' +
      'ê²°ë¡ : 24ê°œì›”+ ì¥ê¸° ëª¨ìœ¼ê¸°ì— ê°•í•œ ì‹ í˜¼ì§‘ ìê¸ˆ ì ê¸ˆ.\n' +
      'ì¶”ì²œ ìƒí’ˆ: ì£¼ê±°ë˜í•˜ë‚˜ ì›”ë³µë¦¬ì ê¸ˆ',
  },
};

const showSavingRecommendation = async (category) => {
  const rec = savingRecommendations[category];
  if (!rec) {
    await sendBotMessage(
      'ì´ ì¹´í…Œê³ ë¦¬ì— ëŒ€í•œ ì¶”ì²œ ì •ë³´ë¥¼ ì°¾ì§€ ëª»í–ˆì–´ìš”. ë‹¤ë¥¸ í•­ëª©ì„ ê³¨ë¼ì£¼ì„¸ìš”!'
    );
    return;
  }
  await sendBotMessage(rec.summary);
  // ìƒì„¸ ë³´ê¸° CTA (router ì´ë™)
  ctas.value = [
    { label: `${rec.name} ìƒì„¸ ë³´ê¸°`, route: `/detail/saving/${rec.id}` },
  ];
};

const showDepositRecommendation = async (category) => {
  const rec = depositRecommendations[category];
  if (!rec) {
    await sendBotMessage(
      'ì´ ì¹´í…Œê³ ë¦¬ì— ëŒ€í•œ ì¶”ì²œ ì •ë³´ë¥¼ ì°¾ì§€ ëª»í–ˆì–´ìš”. ë‹¤ë¥¸ í•­ëª©ì„ ì„ íƒí•´ ì£¼ì„¸ìš”!'
    );
    return;
  }
  await sendBotMessage(rec.summary);
  // ìƒì„¸ ë³´ê¸° CTA (router ì´ë™)
  ctas.value = [
    { label: `${rec.name} ìƒì„¸ ë³´ê¸°`, route: `/detail/deposit/${rec.id}` },
  ];
};

/* íƒ€ì íš¨ê³¼ */
const typeMessage = async (text) => {
  const delay = TYPING_DELAY_MS;
  let typedText = '';
  messages.value.push({ role: 'bot', content: '' }); // ì¶œë ¥ ìŠ¬ë¡¯ ìƒì„±
  for (let i = 0; i < text.length; i++) {
    typedText += text[i];
    messages.value[messages.value.length - 1].content = typedText;
    scrollToBottom();
    await new Promise((r) => setTimeout(r, delay));
  }
};

/* (ì²« ì¸ì‚¬ ì œì™¸) ëª¨ë“  ë´‡ ë©”ì‹œì§€ ì „ ë¡œë”© í‘œì‹œ */
const sendBotMessage = async (content, { isFirst = false } = {}) => {
  if (!isFirst) {
    messages.value.push({ role: 'loading', content: '...' });
    scrollToBottom();
    await new Promise((r) => setTimeout(r, 800)); // ë¡œë”© 0.8ì´ˆ
    messages.value.pop();
  }
  await typeMessage(content);
  scrollToBottom();
};

// toggleChat: ì¸ì‚¬ë§ ì¦‰ì‹œ ì¶œë ¥
const toggleChat = () => {
  isOpen.value = !isOpen.value;

  if (isOpen.value) {
    clearButtonTimers();
    // ê¸°ì¡´ ëŒ€í™”ê°€ ì—†ì„ ë•Œë§Œ ì´ˆê¸°í™” ì¸ì‚¬
    if (messages.value.length === 0) {
      ctas.value = [];
      visibleButtons.value = [];
      currentParentMenu.value = null;
      showBotMessageImmediate(
        `ì•ˆë…•í•˜ì„¸ìš”. <strong>ë§ì¶”ë¨¸ë‹ˆ ì±—ë´‡</strong>ì…ë‹ˆë‹¤! ë¬´ì—‡ì„ ë„ì™€ë“œë¦´ê¹Œìš”?`
      );
      scheduleButtons(allButtons, { clear: true, base: 800, step: 220 });
    }
  } else {
    clearButtonTimers();
    ctas.value = [];
    messages.value = [];
    visibleButtons.value = [];
    currentParentMenu.value = null;
  }
};

/* ë¼ìš°íŒ… ë³€ê²½ ì‹œ ì„¸ì´í”„ê°€ë“œ */
router.afterEach(() => {
  clearButtonTimers();
});

/* ========== ë°±ì—”ë“œ í˜¸ì¶œ(ì¼ë°˜ ì…ë ¥) ========== */
const sendToGPT = async (text) => {
  try {
    const res = await axios.post('/api/chatbot', {
      message: text,
      systemPrompt,
    });
    return res.data.reply;
  } catch (err) {
    console.error(err);
    return 'âš ï¸ ì„œë²„ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.';
  }
};

const sendMessage = async () => {
  if (!input.value.trim()) return;

  // ìœ ì € ì…ë ¥
  const userText = input.value.trim();
  messages.value.push({ role: 'user', content: userText });
  input.value = '';

  // ë²„íŠ¼ì´ ë³´ì´ëŠ” ì¤‘ì´ë¼ë©´ í´ë¦­ê³¼ ë™ì¼í•˜ê²Œ ì¦‰ì‹œ ìˆ¨ê¹€
  clearButtonTimers();
  visibleButtons.value = [];
  await nextTick();

  // âœ… ì‚¬ìš©ìê°€ ì§ì ‘ ìš©ì–´ë¥¼ ì…ë ¥í•œ ê²½ìš°: 'ê¸ˆìœµ ìš©ì–´ ë¬¼ì–´ë³´ê¸°' í•˜ìœ„ ëª©ë¡ê³¼ ë§¤ì¹­
  const terms = submenuMap['ê¸ˆìœµ ìš©ì–´ ë¬¼ì–´ë³´ê¸°'] || [];
  if (terms.includes(userText)) {
    await explainTerm(userText); // â¬…ï¸ ë™ì¼ í”Œë¡œìš°
    return;
  }

  // ì¼ë°˜ ì§ˆë¬¸ì€ ê¸°ì¡´ GPT íë¦„
  const botReply = await sendToGPT(userText);
  await sendBotMessage(botReply);
};

const handleQuickButtonClick = async (index) => {
  if (isMenuTransitioning.value) return;
  isMenuTransitioning.value = true;

  const selectedText = visibleButtons.value[index];

  // í´ë¦­ ì¦‰ì‹œ ë²„íŠ¼ ìˆ¨ê¹€
  clearButtonTimers();
  visibleButtons.value = [];
  await nextTick();

  // ì‚¬ìš©ì ë§í’ì„ 
  messages.value.push({ role: 'user', content: selectedText });
  scrollToBottom();

  // 0) í›„ì† ë²„íŠ¼ ë¨¼ì € ì²˜ë¦¬
  if (selectedText === 'ê´œì°®ì•„ìš”') {
    await sendBotMessage(
      'ì¢‹ì•„ìš”! ë‹¤ë¥¸ ì£¼ì œë‚˜ ìš©ì–´ë„ ì–¸ì œë“ ì§€ ë¬¼ì–´ë´ ì£¼ì„¸ìš” ğŸ™‚'
    );
    lastExplainedTerm.value = null;
    ctas.value = [];
    isMenuTransitioning.value = false;
    return;
  }

  if (selectedText === 'ë” ì‰½ê²Œ ì„¤ëª…í•´ì¤˜') {
    await explainTermSimpler(); // â¬…ï¸ ì„¤ëª… í›„ ë²„íŠ¼ ì¬ë…¸ì¶œ(ë¬´í•œë°˜ë³µ)
    ctas.value = [];
    isMenuTransitioning.value = false;
    return;
  }

  /* 1) ìƒìœ„ ë©”ë‰´: ì•ˆë‚´ í›„ í•˜ìœ„ ë²„íŠ¼ì„ ìˆœì°¨ ë“±ì¥ */
  if (submenuMap[selectedText]) {
    currentParentMenu.value = selectedText;
    ctas.value = [];

    let intro = '';
    if (selectedText === 'ì¹´ë“œ ì¶”ì²œë°›ê¸°') {
      selectedCardType.value = null; // ì´ˆê¸°í™”
      intro = 'ì¢‹ì•„ìš”! ë¨¼ì € ì¹´ë“œ ì¢…ë¥˜ë¥¼ ì„ íƒí•´ ì£¼ì„¸ìš”. (ì‹ ìš©ì¹´ë“œ/ì²´í¬ì¹´ë“œ)';
      await sendBotMessage(intro);
      // ì¹´ë“œ íƒ€ì… ë‘ ê°œ ë¨¼ì € ë³´ì—¬ì£¼ê¸°
      scheduleButtons(CARD_TYPE_OPTIONS, { clear: true, base: 800, step: 220 });
      isMenuTransitioning.value = false;
      return;
    }
    // âœ… ìƒìœ„ ë©”ë‰´ì— ë”°ë¼ ë¬¸ë§¥ ë§ì¶˜ ì¸íŠ¸ë¡œ ë¬¸êµ¬
    else if (selectedText === 'ì˜ˆê¸ˆ ì¶”ì²œë°›ê¸°') {
      intro = 'ì˜ˆê¸ˆìœ¼ë¡œ ì–´ë–¤ ëª©ì ì„ ì¤€ë¹„ ì¤‘ì´ì‹ ê°€ìš”? ëª©ì ì„ ì„ íƒí•´ ì£¼ì„¸ìš”.';
    } else if (selectedText === 'ì ê¸ˆ ì¶”ì²œë°›ê¸°') {
      intro = 'ì ê¸ˆìœ¼ë¡œ ëª¨ìœ¼ê³  ì‹¶ì€ ëª©í‘œê°€ ë¬´ì—‡ì¸ê°€ìš”? ì•„ë˜ì—ì„œ ê³¨ë¼ì£¼ì„¸ìš”.';
    } else if (selectedText === 'ì„œë¹„ìŠ¤ ì´ìš©ë°©ë²•') {
      intro = 'ì›í•˜ì‹œëŠ” ì•ˆë‚´ë¥¼ ì„ íƒí•´ ì£¼ì„¸ìš”.';
    } else if (selectedText === 'í˜ë¥´ì†Œë‚˜ ìœ í˜• ì„¤ëª…') {
      intro = 'ì•„ë˜ì—ì„œ ìì‹ ì˜ ì„±í–¥ê³¼ ê°€ì¥ ê°€ê¹Œìš´ ë™ë¬¼ì„ ì„ íƒí•´ ì£¼ì„¸ìš”.';
    } else if (selectedText === 'ê¸ˆìœµ ìš©ì–´ ë¬¼ì–´ë³´ê¸°') {
      intro = 'ì–´ë–¤ ìš©ì–´ê°€ ì–´ë µë‚˜ìš”? ì•„ë˜ì—ì„œ ì„ íƒí•˜ê±°ë‚˜ ì§ì ‘ ì…ë ¥í•´ ì£¼ì„¸ìš”.';
    } else {
      intro = `${selectedText} í•­ëª©ì…ë‹ˆë‹¤. ì•„ë˜ì—ì„œ ì„ íƒí•´ ì£¼ì„¸ìš”.`;
    }

    await sendBotMessage(intro);
    scheduleButtons(submenuMap[selectedText], {
      clear: true,
      base: 800,
      step: 220,
    });
    isMenuTransitioning.value = false;
    return;
  }

  /* 2) ê¸ˆìœµ ìš©ì–´ ë¬¼ì–´ë³´ê¸° â€” ì„ íƒ í…ìŠ¤íŠ¸ê°€ 'ê¸ˆìœµ ìš©ì–´' í•˜ìœ„ ëª©ë¡ì— ìˆì„ ë•Œë§Œ */
  if (submenuMap['ê¸ˆìœµ ìš©ì–´ ë¬¼ì–´ë³´ê¸°']?.includes(selectedText)) {
    await explainTerm(selectedText); // â¬…ï¸ í—¬í¼ ì‚¬ìš©
    ctas.value = [];
    isMenuTransitioning.value = false;
    return;
  }

  /* 3) í˜ë¥´ì†Œë‚˜ ìœ í˜• ì„¤ëª… â€” ì„¤ëª… + ê²°ê³¼ í˜ì´ì§€ CTA */
  if (submenuMap['í˜ë¥´ì†Œë‚˜ ìœ í˜• ì„¤ëª…']?.includes(selectedText)) {
    const code = personaCodeMap[selectedText];
    const desc =
      personaDescriptions[selectedText] ||
      'ì´ ìœ í˜•ì€ ì¬ë¬´ ëª©í‘œì™€ ìœ„í—˜ ì„ í˜¸ì— ë”°ë¼ ë§ì¶¤ ì „ëµì´ ë‹¬ë¼ì§‘ë‹ˆë‹¤.';
    await sendBotMessage(desc);

    if (code) {
      ctas.value = [
        {
          label: `${selectedText} ìì„¸íˆ ë³´ëŸ¬ê°€ê¸°`,
          route: `/persona/result/${code}`,
        },
      ];
    } else {
      ctas.value = [];
    }
    isMenuTransitioning.value = false;
    return;
  }

  /* 4) ì„œë¹„ìŠ¤ ì´ìš©ë°©ë²• í•˜ìœ„ */
  if (serviceLinks[selectedText]) {
    await sendBotMessage(
      `<strong>ì„œë¹„ìŠ¤ ì´ìš©ë°©ë²•</strong> ì¤‘ì—ì„œ <strong>${selectedText}</strong> ì•ˆë‚´ë¥¼ ë³´ì—¬ë“œë¦´ê²Œìš”!`
    );
    await sendBotMessage(quickButtonPrompts[selectedText] || selectedText);

    const route = serviceLinks[selectedText];
    const label =
      selectedText === 'í˜ë¥´ì†Œë‚˜ ê¸°ë°˜ ì¶”ì²œ'
        ? 'í˜ë¥´ì†Œë‚˜ ê¸°ë°˜ ì¶”ì²œ ë°›ìœ¼ëŸ¬ ê°€ê¸°'
        : `${selectedText} ë°”ë¡œ ê°€ê¸°`;
    ctas.value = [{ label, route }];

    isMenuTransitioning.value = false;
    return;
  }
  // ì¹´ë“œ íƒ€ì…ì„ ì„ íƒí•œ ê²½ìš°
  if (CARD_TYPE_OPTIONS.includes(selectedText)) {
    selectedCardType.value = selectedText; // 'ì‹ ìš©ì¹´ë“œ' or 'ì²´í¬ì¹´ë“œ'
    await sendBotMessage(
      `${selectedText}ë¡œ ì§„í–‰í• ê²Œìš”. í‰ì†Œ ì–´ë–¤ ì†Œë¹„ê°€ ê°€ì¥ ë§ìœ¼ì„¸ìš”? ì•„ë˜ì—ì„œ ì„ íƒí•´ ì£¼ì„¸ìš”.`
    );
    // ì¹´ë“œ ì¹´í…Œê³ ë¦¬ ë²„íŠ¼ ë“±ì¥
    scheduleButtons(submenuMap['ì¹´ë“œ ì¶”ì²œë°›ê¸°'], {
      clear: true,
      base: 800,
      step: 220,
    });
    isMenuTransitioning.value = false;
    return;
  }
  // ì¹´ë“œ ì¶”ì²œë°›ê¸° í•˜ìœ„ ì¹´í…Œê³ ë¦¬ í´ë¦­ ì²˜ë¦¬
  if (
    currentParentMenu.value === 'ì¹´ë“œ ì¶”ì²œë°›ê¸°' &&
    submenuMap['ì¹´ë“œ ì¶”ì²œë°›ê¸°']?.includes(selectedText)
  ) {
    await showCardRecommendation(selectedText);
    isMenuTransitioning.value = false;
    return;
  }
  // ì˜ˆê¸ˆ ì¶”ì²œë°›ê¸° í•˜ìœ„ ì¹´í…Œê³ ë¦¬ í´ë¦­ ì²˜ë¦¬
  if (
    currentParentMenu.value === 'ì˜ˆê¸ˆ ì¶”ì²œë°›ê¸°' &&
    submenuMap['ì˜ˆê¸ˆ ì¶”ì²œë°›ê¸°']?.includes(selectedText)
  ) {
    await showDepositRecommendation(selectedText);
    isMenuTransitioning.value = false;
    return;
  }
  // ì ê¸ˆ ì¶”ì²œë°›ê¸° í•˜ìœ„ ì¹´í…Œê³ ë¦¬ í´ë¦­ ì²˜ë¦¬
  if (
    currentParentMenu.value === 'ì ê¸ˆ ì¶”ì²œë°›ê¸°' &&
    submenuMap['ì ê¸ˆ ì¶”ì²œë°›ê¸°']?.includes(selectedText)
  ) {
    await showSavingRecommendation(selectedText);
    isMenuTransitioning.value = false;
    return;
  }

  /* 5) ê¸°íƒ€ ì¼ë°˜ í•˜ìœ„ */
  await sendBotMessage(
    `<strong>${
      currentParentMenu.value ?? ''
    }</strong> ì¤‘ì—ì„œ <strong>${selectedText}</strong>ì— ëŒ€í•´ ì•ˆë‚´ë“œë¦´ê²Œìš”!`
  );
  await sendBotMessage(quickButtonPrompts[selectedText] || selectedText);
  ctas.value = [];
  isMenuTransitioning.value = false;
};

/* ========== ë§ˆìš´íŠ¸/ì–¸ë§ˆìš´íŠ¸ ========== */
onMounted(() => {
  clearButtonTimers();
  ctas.value = [];
});
onBeforeUnmount(() => {
  clearButtonTimers();
  ctas.value = [];
});

/* í…œí”Œë¦¿ì—ì„œ ì‚¬ìš©í•  ê²ƒ ë…¸ì¶œ (CTA ë²„íŠ¼ í´ë¦­ ì‹œ ì‚¬ìš©) */
defineExpose({ goRoute, ctas });
</script>

<style scoped>
.chatbot-container {
  position: fixed;
  bottom: 35px;
  right: 35px;
  z-index: 10000;
}
.chatbot-container.dragging { transition: none; }

.chat-toggle {
  background: transparent;
  border: 2px solid #cfe5a2;
  border-radius: 50%;
  width: 80px;
  height: 80px;
  cursor: pointer;
  box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
  display: flex;
  align-items: center;
  justify-content: center;
  transition: transform 0.3s ease;
  padding: 0;
}
.chat-toggle:hover {
  transform: scale(1.1);
}
.chat-toggle img {
  width: 100%;
  height: 100%;
  object-fit: contain;
  border-radius: 50%;
}
@media (max-width: 768px) {
  .chat-toggle {
    width: 64px;
    height: 64px;
  }
}
@media (max-width: 480px) {
  .chat-toggle {
    width: 56px;
    height: 56px;
  }
}

.chat-window {
  width: 360px;
  height: 550px;
  background: #fff;
  border-radius: 12px;
  box-shadow: 0 8px 20px rgba(0, 0, 0, 0.25);
  overflow: hidden;
  display: flex;
  flex-direction: column;
  position: absolute;
  bottom: calc(80px + 40px); /* í† ê¸€(80px) + ì—¬ë°± 40px â†’ ë²„íŠ¼ ì•ˆê°€ë¦¬ê²Œ ë” ìœ„ë¡œ */
  right: 20px;
  font-family: 'Pretendard', sans-serif;
  animation: slideUp 0.4s ease;
}

/* ë°˜ì‘í˜•: íƒœë¸”ë¦¿ ì‚¬ì´ì¦ˆì—ì„œ ëŒ€í™”ì°½ ì¶•ì†Œ */
@media (max-width: 768px) {
  .chat-window {
    width: 320px;
    height: 72vh;
    right: 12px;
    bottom: calc(64px + 28px); /* í† ê¸€(64px) + ì—¬ë°± 28px */
  }
  .chatbot-container {
    right: 12px;
    bottom: 16px;
  }
}

/* ë°˜ì‘í˜•: ëª¨ë°”ì¼ ì‚¬ì´ì¦ˆì—ì„œ ë” ì‘ê²Œ */
@media (max-width: 480px) {
  .chat-window {
    position: fixed; /* ë·°í¬íŠ¸ ê¸°ì¤€ ê³ ì • */
    left: 3vw; /* ì¢Œìš° ì—¬ë°± ì¡°ê¸ˆ ì¤„ì—¬ ë” ë„“ê²Œ */
    right: 3vw;
    bottom: calc(56px + 16px); /* í† ê¸€(56px) + ì—¬ë°± 16px */
    width: auto; /* ê³ ì •í­ ì œê±° */
    max-width: 94vw; /* ì•ˆì „ í­ */
    height: auto; /* ê³ ì •ë†’ì´ ì œê±° */
    min-height: 60dvh; /* ìµœì†Œ ë†’ì´ í™•ë³´ */
    max-height: 82dvh; /* í™”ë©´ ëŒ€ë¹„ í¬ê²Œ (ìƒë‹¨ ë…¸ì¹˜/ë¸Œë¼ìš°ì € UI ê³ ë ¤) */
  }
  .chat-body {
    overflow-y: auto;
  }
}
@keyframes slideUp {
  from {
    opacity: 0;
    transform: translateY(20px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

.fade-up-enter-active,
.fade-up-leave-active {
  transition: all 0.4s ease;
}
.fade-up-enter-from {
  opacity: 0;
  transform: translateY(20px);
}
.fade-up-enter-to {
  opacity: 1;
  transform: translateY(0);
}

.chat-header {
  background: #fff;
  padding: 12px;
  font-weight: bold;
  border-bottom: 1px solid #ddd;
  text-align: center;
  position: relative;
}
.chat-title {
  font-size: 18px;
}
.chat-title .icon {
  width: 18px;
  height: 18px;
  vertical-align: middle;
  margin-right: 4px;
}
.chat-actions {
  position: absolute;
  top: 50%;
  right: 12px;
  transform: translateY(-50%);
  display: flex;
  gap: 8px;
  align-items: center;
}
.chat-btn {
  background: none;
  border: none;
  font-size: 13px;
  cursor: pointer;
  color: #666;
  padding: 0;
  transition: transform 0.2s ease;
}

.chat-body {
  padding: 12px;
  flex: 1;
  overflow-y: auto;
}

.message-wrapper {
  display: flex;
  align-items: flex-start;
  margin-bottom: 12px;
}
.message-wrapper.user {
  justify-content: flex-end;
}
.message-wrapper.bot {
  justify-content: flex-start;
}

.avatar {
  width: 28px;
  height: 28px;
  border-radius: 50%;
  margin-right: 8px;
  flex-shrink: 0;
}

.message.bot {
  position: relative;
  background: #e0f2c2;
  padding: 8px 12px;
  border-radius: 16px;
  border-bottom-left-radius: 4px;
  margin-bottom: 0;
  width: fit-content;
  max-width: 80%;
  font-size: 14px;
  color: #000;
  text-align: left;
}
.message.user {
  margin-left: auto;
  background: #e3e8eb;
  padding: 8px 12px;
  border-radius: 16px;
  border-bottom-right-radius: 4px;
  margin-bottom: 0;
  width: fit-content;
  max-width: 80%;
  font-size: 14px;
  color: #000;
  text-align: left;
}
.message.loading {
  background: #e0f2c2;
  padding: 8px 12px;
  border-radius: 16px;
  border-bottom-left-radius: 4px;
  margin-bottom: 12px;
  width: fit-content;
  max-width: 80%;
  font-size: 14px;
  color: #000;
  text-align: left;
}

.spinner {
  width: 24px;
  height: 24px;
  border: 3px solid #cfe5a2;
  border-top: 3px solid #a0c28d;
  border-radius: 50%;
  animation: spin 1s linear infinite;
  margin-bottom: 12px;
  margin-left: 6px;
}
@keyframes spin {
  0% {
    transform: rotate(0deg);
  }
  100% {
    transform: rotate(360deg);
  }
}

.quick-buttons {
  display: flex;
  flex-wrap: wrap;
  gap: 8px;
  margin-bottom: 12px;
}

.quick-btn {
  padding: 5px 12px;
  border: 1px solid #a0c28d;
  border-radius: 16px;
  background: white;
  font-size: 13px;
  cursor: pointer;
  white-space: nowrap;
}
.quick-btn:active {
  background: #a0c28d;
  color: #fff;
  border-color: #a0c28d;
}
.quick-btn.selected {
  background: #a0c28d;
  color: #fff;
  border-color: #a0c28d;
}

/* ìƒìœ„ ë²„íŠ¼: 2ì¤„ í—ˆìš© */
.quick-btn.main-menu {
  padding: 5px 10px;
  border: 1px solid #a0c28d;
  border-radius: 16px;
  background: white;
  font-size: 12px;
  white-space: normal; /* ì¤„ë°”ê¿ˆ í—ˆìš© */
  word-break: keep-all; /* ë‹¨ì–´ ë‹¨ìœ„ ì¤„ë°”ê¿ˆ */
  text-align: center;
  max-width: 120px;
}

/* í•˜ìœ„ ë²„íŠ¼: í•œ ì¤„ ê³ ì • */
.quick-btn.sub-menu {
  padding: 4px 10px;
  border: 1px solid #d0e6b5;
  border-radius: 12px;
  background: #f6fbf1;
  font-size: 12px;
  color: #4b6b3d;
  white-space: nowrap; /* ì¤„ë°”ê¿ˆ ê¸ˆì§€ */
  overflow: hidden;
  text-overflow: ellipsis; /* ê¸¸ë©´ ... ì²˜ë¦¬ */
  max-width: 140px;
}

.chat-input {
  display: flex;
  align-items: center;
  border-top: 1px solid #eee;
  padding: 12px;
  background: #fff;
}
.chat-input input {
  flex: 1;
  padding: 12px 16px;
  border: 1px solid #ccc;
  border-radius: 25px;
  font-size: 14px;
  outline: none;
  margin-right: 8px;
  margin-left: 4px;
}
.chat-input input::placeholder {
  color: #888;
}
.chat-input input:focus {
  border-color: #a0c28d;
}
.chat-input button {
  background: none;
  border: none;
  margin-left: 0;
  cursor: pointer;
  padding: 0;
}
.chat-input button img {
  width: 20px;
  height: 20px;
}

.blurred {
  opacity: 0.5;
}
.message span,
.message div {
  white-space: pre-line;
}

.cta-wrap {
  margin-top: 10px;
}
.cta-btn {
  appearance: none;
  -webkit-appearance: none;
  border: none;
  display: inline-flex;
  align-items: center;
  gap: 8px;
  padding: 10px 14px;
  border-radius: 999px;
  background: #a0c28d; /* ë§í’ì„ ê³¼ ì–´ìš¸ë¦¬ëŠ” ê·¸ë¦° */
  color: #fff;
  font-size: 13px;
  font-weight: 700;
  box-shadow: 0 2px 6px rgba(0, 0, 0, 0.12);
  cursor: pointer;
  transition: transform 0.08s ease, box-shadow 0.12s ease, opacity 0.12s ease;
}
.cta-btn:hover {
  box-shadow: 0 3px 10px rgba(0, 0, 0, 0.16);
  opacity: 0.95;
}
.cta-btn:active {
  transform: translateY(1px);
}
.cta-btn:focus {
  outline: 2px solid #88b47b;
  outline-offset: 2px;
}
.cta-text {
  line-height: 1;
}
.cta-arrow {
  line-height: 1;
  font-size: 14px;
}
.cta-buttons {
  display: flex;
  flex-wrap: wrap;
  gap: 8px;
  margin: 8px 0 4px;
}
.cta-button {
  appearance: none;
  -webkit-appearance: none;
  border: none;
  padding: 10px 14px;
  border-radius: 999px;
  background: #a0c28d; /* í†¤ ë§ì¶˜ ê·¸ë¦° */
  color: #fff;
  font-size: 13px;
  font-weight: 700;
  box-shadow: 0 2px 6px rgba(0, 0, 0, 0.12);
  cursor: pointer;
  transition: transform 0.08s ease, box-shadow 0.12s ease, opacity 0.12s ease;
}
.cta-button:hover {
  box-shadow: 0 3px 10px rgba(0, 0, 0, 0.16);
  opacity: 0.95;
}
.cta-button:active {
  transform: translateY(1px);
}
.cta-button:focus {
  outline: 2px solid #88b47b;
  outline-offset: 2px;
}
</style>
